<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 善度四旬期与告解圣事深度全指南</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6d28d9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="四旬期指南">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js" defer></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Noto+Serif+SC:wght@400;700;900&display=swap');
        
        :root { 
            --church-violet: #6d28d9; 
            --church-indigo: #4338ca; 
            --church-emerald: #10b981; 
        }
        
        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: #f8f7fc; 
            color: #111827; 
            scroll-behavior: smooth; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        .font-serif-church { 
            font-family: 'Noto Serif SC', serif; 
        }
        
        .tab-content { display: none; }
        .tab-content.active { 
            display: block; 
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); 
        }
        
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .milestone-dot { 
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            cursor: pointer; 
            background-color: rgba(139, 92, 246, 0.4); 
        }
        
        .active-dot { 
            background-color: white !important; 
            box-shadow: 0 0 15px rgba(255,255,255,0.9); 
            transform: scale(1.35); 
        }
        
        .task-item.is-checked { background-color: #f0fdf4 !important; border-color: #86efac !important; }
        .task-item.is-checked .check-box { background-color: #22c55e !important; border-color: #22c55e !important; }
        .task-item.is-checked .check-svg { display: block !important; }
        
        .exam-item.is-checked { background-color: #eef2ff !important; border-color: #a5b4fc !important; }
        .exam-item.is-checked .exam-check-box { background-color: #4f46e5 !important; border-color: #4f46e5 !important; }
        .exam-item.is-checked .exam-check-svg { display: block !important; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .shadow-premium { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
        .station-accent { border-left: 6px solid #4b5563; }
        .station-accent:hover { border-left-color: #7c3aed; }
        .conf-nav-active { background-color: #4f46e5 !important; color: white !important; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .prose-church { line-height: 2.2; letter-spacing: 0.01em; }
    </style>
</head>
<body class="pb-32">
    <div id="loading-screen" class="fixed inset-0 bg-[#f8f7fc] z-[999] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-12 h-12 border-4 border-violet-200 border-t-violet-700 rounded-full animate-spin mb-4"></div>
        <p class="text-violet-900 font-bold text-sm">正在加载堂区灵修资源...</p>
    </div>

    <header class="bg-white/90 backdrop-blur-xl border-b sticky top-0 z-[100] pt-[env(safe-area-inset-top)]">
        <div class="max-w-2xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="showTab('home')">
                <div class="bg-violet-700 p-2.5 rounded-2xl text-white shadow-lg shadow-violet-200">
                    <i data-lucide="cross"></i>
                </div>
                <div>
                    <h1 class="text-lg font-black text-violet-950 leading-none tracking-tight">2026 善度四旬期</h1>
                    <span class="text-[10px] text-violet-500 uppercase tracking-widest font-bold">深度灵修与告解全指南</span>
                </div>
            </div>
            <button onclick="showTab('liturgy')" class="text-xs font-black px-5 py-2.5 rounded-full text-violet-700 bg-violet-50 border border-violet-100 hover:bg-violet-100 transition-all flex items-center gap-2">
                <i data-lucide="info" class="w-3.5 h-3.5"></i> 认识四旬期
            </button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-6 py-8">
        
        <div id="home" class="tab-content active space-y-8">
            <div class="bg-gradient-to-br from-violet-800 via-violet-950 to-indigo-950 rounded-[3rem] p-8 text-white shadow-2xl relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 w-48 h-48 bg-white/5 rounded-full blur-3xl"></div>
                <div class="flex justify-between items-center mb-10">
                    <div class="flex items-center gap-3">
                        <div class="bg-white/10 p-2.5 rounded-xl backdrop-blur-md border border-white/10"><i data-lucide="compass" class="w-5 h-5 text-violet-200"></i></div>
                        <span id="progress-week-text" class="font-black text-sm tracking-wide">载入进度...</span>
                    </div>
                    <span id="progress-text" class="bg-white/20 px-4 py-1 rounded-full text-[10px] font-black uppercase tracking-widest border border-white/5">Day 0 / 46</span>
                </div>
                <div class="relative px-2 mb-16">
                    <div class="w-full bg-white/10 rounded-full h-3 overflow-hidden shadow-inner">
                        <div id="progress-bar" class="bg-white h-full rounded-full transition-all duration-1000 shadow-[0_0_20px_rgba(255,255,255,0.6)]" style="width: 0%"></div>
                    </div>
                    <div id="milestones-container" class="absolute top-1/2 -translate-y-1/2 w-full left-0 px-0 flex justify-between pointer-events-none"></div>
                    <div class="absolute w-full flex justify-between mt-6 px-0 text-[8px] font-black opacity-90 leading-tight">
                        <div class="flex flex-col items-center w-12 -ml-4 text-center"><span>圣灰礼仪</span><span class="opacity-50 mt-0.5">2/18</span></div>
                        <div class="flex flex-col items-center w-12 text-center"><span>第一主日</span><span class="opacity-50 mt-0.5">2/22</span></div>
                        <div class="flex flex-col items-center w-12 text-center"><span>第二主日</span><span class="opacity-50 mt-0.5">3/01</span></div>
                        <div class="flex flex-col items-center w-12 text-center"><span>第三主日</span><span class="opacity-50 mt-0.5">3/08</span></div>
                        <div class="flex flex-col items-center w-12 text-center"><span>第四主日</span><span class="opacity-50 mt-0.5">3/15</span></div>
                        <div class="flex flex-col items-center w-12 text-center text-amber-300"><span>第五主日</span><span class="opacity-50 mt-0.5">3/22</span></div>
                        <div class="flex flex-col items-center w-12 text-red-300"><span>圣枝主日</span><span class="opacity-50 mt-0.5">3/29</span></div>
                        <div class="flex flex-col items-center w-12 -mr-4 text-yellow-300 text-center"><span>复活瞻礼</span><span class="opacity-50 mt-0.5">4/05</span></div>
                    </div>
                </div>
                <div class="flex justify-between items-end text-[10px] opacity-70 border-t border-white/10 pt-4">
                    <div><span class="font-bold">2026 四旬期旅程</span></div>
                    <div class="text-right"><span id="today-date-string" class="text-xs font-black tracking-tighter block">载入中...</span><span class="font-bold uppercase opacity-50 tracking-widest">Today</span></div>
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-2xl p-4 text-center">
                <p class="text-[10px] text-gray-500 font-bold flex items-center justify-center gap-2">
                    <i data-lucide="shield-check" class="w-3.5 h-3.5"></i>
                    声明：此为静态网页，您的打卡及告解记录仅保存于本机，请放心使用。
                </p>
            </div>

            <div class="bg-amber-50 border border-amber-200 rounded-[2.5rem] p-6 flex gap-5 items-center shadow-sm relative overflow-hidden group">
                <div class="w-14 h-14 bg-amber-100 text-amber-700 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-inner">
                    <i data-lucide="bell" class="w-7 h-7 animate-bounce"></i>
                </div>
                <div class="flex-1 relative z-10">
                    <h4 class="text-sm font-black text-amber-950 mb-1.5">深圳圣安多尼堂特别通知</h4>
                    <p class="text-[11px] text-amber-800 leading-relaxed font-bold">
                        四旬期内 <span class="bg-amber-200/50 px-2 py-0.5 rounded text-amber-900 font-black">每周五 15:00</span> 举行拜苦路善功，随后举行弥撒。请信友踊跃参与。
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="showTab('weekly')" class="bg-white p-7 rounded-[2.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-xl transition-all group">
                    <div class="w-16 h-16 rounded-2xl bg-violet-50 text-violet-600 flex items-center justify-center mb-4 shadow-inner group-hover:scale-110 transition-transform"><i data-lucide="layers"></i></div>
                    <span class="text-sm font-black text-gray-800">每周重点</span>
                </button>
                <button onclick="showTab('stations')" class="bg-white p-7 rounded-[2.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-xl transition-all group">
                    <div class="w-16 h-16 rounded-2xl bg-stone-50 text-stone-700 flex items-center justify-center mb-4 shadow-inner group-hover:scale-110 transition-transform"><i data-lucide="milestone"></i></div>
                    <span class="text-sm font-black text-gray-800">苦路善功</span>
                </button>
                <button onclick="showTab('confession')" class="bg-white p-7 rounded-[2.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-xl transition-all group">
                    <div class="w-16 h-16 rounded-2xl bg-indigo-50 text-indigo-700 flex items-center justify-center mb-4 shadow-inner group-hover:scale-110 transition-transform"><i data-lucide="heart-handshake"></i></div>
                    <span class="text-sm font-black text-gray-800">告解圣事</span>
                </button>
                <button onclick="showTab('holyweek')" class="bg-white p-7 rounded-[2.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-xl transition-all group">
                    <div class="w-16 h-16 rounded-2xl bg-red-50 text-red-600 flex items-center justify-center mb-4 shadow-inner group-hover:scale-110 transition-transform"><i data-lucide="flame"></i></div>
                    <span class="text-sm font-black text-gray-800">圣周指南</span>
                </button>
            </div>

            <div class="bg-white rounded-[3rem] p-10 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-10">
                    <div class="space-y-1">
                        <h3 class="text-2xl font-black text-gray-900 tracking-tight">今日修德方案</h3>
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-[0.2em]">Spiritual Training Plan</p>
                    </div>
                    <div class="bg-violet-100 text-violet-700 p-3.5 rounded-2xl cursor-pointer" onclick="alert('勾选的任务将自动保存在您的手机中，即使关闭网页也不会丢失哦！')"><i data-lucide="save" class="w-6 h-6"></i></div>
                </div>
                <div class="bg-violet-50 p-7 rounded-[2rem] mb-10 border border-violet-100/50 shadow-inner relative overflow-hidden group">
                    <div class="absolute -right-4 -top-4 opacity-5 group-hover:rotate-45 transition-transform"><i data-lucide="quote" class="w-24 h-24 text-violet-900"></i></div>
                    <h5 class="text-[10px] font-black text-violet-400 uppercase tracking-widest mb-3 flex items-center gap-2"><i data-lucide="message-circle" class="w-3.5 h-3.5"></i> 今日灵修指引</h5>
                    <p id="dynamic-guidance-text" class="text-base text-violet-950 font-bold leading-relaxed italic font-serif-church">载入今日方案...</p>
                </div>
                <div id="task-categories" class="space-y-12"></div>
            </div>

            <footer class="pt-10 pb-4 text-center">
                <p class="text-[10px] text-gray-400 font-black tracking-widest uppercase mb-1">Produced By</p>
                <p class="text-xs text-gray-500 font-bold">SAC划向深处小组制作</p>
            </footer>
        </div>

        <div id="weekly" class="tab-content space-y-10 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-violet-600 font-black gap-2 mb-4 hover:gap-4 transition-all"><i data-lucide="arrow-left" class="w-5 h-5"></i> 返回主页</button>
            <div class="bg-violet-950 text-white p-12 rounded-[4rem] shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-8 opacity-10 rotate-12 scale-125"><i data-lucide="scroll-text" class="w-48 h-48"></i></div>
                <h2 class="text-4xl font-black mb-6 tracking-tighter">每周灵修大纲</h2>
                <p class="text-violet-200 leading-loose text-sm font-medium prose-church">四旬期是一场灵魂由世俗之“奴役”走向天主之“自由”的伟大法行。每周的主日福音都是这一段航程的灯塔。</p>
            </div>
            <div id="weekly-list" class="space-y-16 pb-12"></div>
        </div>

        <div id="stations" class="tab-content space-y-10 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-stone-700 font-black gap-2 mb-4 hover:gap-4 transition-all"><i data-lucide="arrow-left" class="w-5 h-5"></i> 返回主页</button>
            <div class="bg-stone-900 text-white p-12 rounded-[4rem] shadow-2xl relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 p-4 opacity-10"><i data-lucide="cross" class="w-64 h-64"></i></div>
                <h2 class="text-4xl font-black mb-6 tracking-tighter">拜苦路深度默想</h2>
                <p class="text-stone-400 text-sm leading-loose italic font-serif-church max-w-lg">“谁若愿意跟随我，该弃绝自己，天天背起自己的十字架跟随我。” (路9:23)</p>
            </div>
            <div id="stations-list" class="space-y-12 pb-12"></div>
        </div>

        <div id="confession" class="tab-content space-y-10 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-indigo-600 font-black gap-2 mb-4 hover:gap-4 transition-all"><i data-lucide="arrow-left" class="w-5 h-5"></i> 返回主页</button>
            
            <div class="bg-white p-2 rounded-[2rem] shadow-premium border border-indigo-50 flex items-center gap-1 sticky top-20 z-50 overflow-x-auto no-scrollbar">
                <button onclick="showConfSub('conf-intro')" class="conf-sub-btn whitespace-nowrap flex-1 py-3 px-6 rounded-full text-xs font-black transition-all conf-nav-active" id="btn-conf-intro">圣事意义</button>
                <button onclick="showConfSub('conf-prep')" class="conf-sub-btn whitespace-nowrap flex-1 py-3 px-6 rounded-full text-xs font-black transition-all text-indigo-700 hover:bg-indigo-50" id="btn-conf-prep">告解准备</button>
                <button onclick="showConfSub('conf-exam')" class="conf-sub-btn whitespace-nowrap flex-1 py-3 px-6 rounded-full text-xs font-black transition-all text-indigo-700 hover:bg-indigo-50" id="btn-conf-exam">详细省察</button>
                <button onclick="showConfSub('conf-step')" class="conf-sub-btn whitespace-nowrap flex-1 py-3 px-6 rounded-full text-xs font-black transition-all text-indigo-700 hover:bg-indigo-50" id="btn-conf-step">实战流程</button>
                <button onclick="showConfSub('conf-prayer')" class="conf-sub-btn whitespace-nowrap flex-1 py-3 px-6 rounded-full text-xs font-black transition-all text-indigo-700 hover:bg-indigo-50" id="btn-conf-prayer">常用经文</button>
            </div>

            <div id="conf-intro" class="conf-section space-y-10">
                <div class="bg-indigo-600 rounded-[3rem] p-10 text-white text-center shadow-lg relative overflow-hidden">
                    <i data-lucide="sun" class="w-16 h-16 mx-auto mb-4 opacity-90"></i>
                    <h2 class="text-3xl font-bold tracking-tight mb-2">和好圣事的恩宠</h2>
                    <p class="text-indigo-200 text-sm font-medium">天父永远张开双臂，等待儿女归来</p>
                </div>
                
                <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                    <h3 class="font-black text-slate-800 text-xl mb-4 flex items-center gap-3"><i data-lucide="heart" class="text-rose-500 w-6 h-6"></i> 慈悲的拥抱</h3>
                    <div class="space-y-4 text-slate-600 text-[15px] leading-relaxed font-medium">
                        <p>告解圣事（又称和好圣事）是天主慈爱的具体表现。耶稣基督作为灵魂的医生，不仅赦免我们的罪过，更治愈我们因罪而受伤的心灵。</p>
                        <p>这不是一种在那位高高在上的法官面前的“审判”，而是并在慈父怀抱中的“重逢”。通过这件圣事，我们与天主和好，与教会团体和好，也与自己和好。</p>
                    </div>
                </div>

                <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100">
                    <h3 class="font-black text-slate-800 text-xl mb-4 flex items-center gap-3"><i data-lucide="users" class="text-indigo-500 w-6 h-6"></i> 为什么向神父告罪？</h3>
                    <div class="space-y-4 text-slate-600 text-[15px] leading-relaxed font-medium">
                        <p>很多教友会问：“我为什么不能直接向天主认罪？”</p>
                        <p>其实，当我们在神父面前告明罪过时，神父代表了基督和教会。耶稣复活后对门徒说：“你们赦免谁的罪，就给谁赦免”（若 20:23）。</p>
                        <p>听见神父说“我赦免你的罪”，这是一个<strong class="text-indigo-600">可见的、确定的</strong>恩宠标记，让我们的人性获得真实的平安与释放。</p>
                    </div>
                </div>
            </div>
            
            <div id="conf-prep" class="conf-section hidden space-y-8">
                <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-indigo-100">
                    <h3 class="text-2xl font-black text-indigo-950 mb-8 flex items-center gap-3"><i data-lucide="hourglass" class="text-indigo-500 w-7 h-7"></i> 告解前的预备</h3>
                    <div class="space-y-6 prose-church text-[15px] text-gray-600">
                        <div class="bg-gray-50 p-6 rounded-[2rem] border border-gray-100">
                            <h4 class="font-black text-gray-900 mb-2">1. 静下心来</h4>
                            <p>寻找一个安静的地方（如圣堂的角落），放下所有焦虑。意识到你即将面对的是一位无比仁慈的父亲，而不是一位冷酷的判官。</p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-[2rem] border border-gray-100">
                            <h4 class="font-black text-gray-900 mb-2">2. 祈求光照</h4>
                            <p>我们往往由于骄傲或习惯而看不清自己的罪。请祈祷：‘圣神，请照亮我的记忆，让我看清冒犯天主的过错，并赐我真心痛悔的力量。’</p>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-[2rem] border border-gray-100">
                            <h4 class="font-black text-gray-900 mb-2">3. 诚实面对</h4>
                            <p>参考“详细省察”清单。不要为罪找借口（如‘由于当时太忙’），而要坦诚说：‘我做了这件事，我很后悔。’</p>
                        </div>
                        <div class="bg-indigo-600 p-8 rounded-[2rem] text-white mt-8 shadow-md">
                            <h5 class="font-black text-[11px] uppercase tracking-widest mb-4 opacity-70">准备祷词 / Preparation Prayer</h5>
                            <p class="text-lg italic font-serif-church font-bold leading-[2]">“我主、我神！我承认我多次犯罪，冒犯了祢无限的尊威。现在我靠祢圣宠的帮助，愿意在神父面前诚实告明。求祢宽恕我的罪，并赐我改过的决心。阿们。”</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="conf-exam" class="conf-section hidden space-y-12">
                <div class="bg-indigo-950 text-white p-10 rounded-[3rem] shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 rotate-12"><i data-lucide="clipboard-list" class="w-48 h-48"></i></div>
                    <h3 class="text-2xl font-black mb-4 flex items-center gap-3 relative z-10"><i data-lucide="search" class="w-6 h-6 text-indigo-400"></i> 灵魂全备省察</h3>
                    <p class="text-[12px] text-indigo-200 leading-loose relative z-10">点击下方各项可记录到您的“待告明清单”中。这些记录<strong class="text-white">仅保存在您的手机本地</strong>，不会上传。主已知道一切，祂只想听见您的诚实。</p>
                </div>
                <div id="exam-list-container" class="space-y-12"></div>
            </div>

            <div id="conf-step" class="conf-section hidden space-y-10">
                <div id="confession-script" class="bg-white p-10 rounded-[3.5rem] border border-indigo-50 shadow-sm space-y-12"></div>
            </div>

            <div id="conf-prayer" class="conf-section hidden space-y-10">
                <div class="bg-white p-10 rounded-[4rem] border border-indigo-100 shadow-premium" id="prayers-container"></div>
            </div>
        </div>

        <div id="holyweek" class="tab-content space-y-10 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-red-600 font-black gap-2 mb-4 hover:gap-4 transition-all"><i data-lucide="arrow-left" class="w-5 h-5"></i> 返回主页</button>
            <div class="bg-red-950 text-white p-12 rounded-[4rem] shadow-2xl relative overflow-hidden">
                <div class="absolute -left-10 -bottom-10 w-48 h-48 bg-red-500 opacity-20 rounded-full blur-[60px]"></div>
                <h2 class="text-4xl font-black mb-6 tracking-tighter">圣周深度指南</h2>
                <p class="text-red-200 leading-[2.2] text-sm font-medium prose-church">逾越节三日庆典是整个救恩史的巅峰。</p>
            </div>
            <div id="holyweek-list" class="space-y-12 pb-12"></div>
        </div>

        <div id="liturgy" class="tab-content space-y-10 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-amber-600 font-black gap-2 mb-4 hover:gap-4 transition-all"><i data-lucide="arrow-left" class="w-5 h-5"></i> 返回主页</button>
            <div class="bg-amber-100 p-12 rounded-[4rem] border border-amber-200 shadow-inner">
                <h2 class="text-4xl font-black text-amber-950 mb-6 tracking-tighter">四旬期深度百科</h2>
                <p class="text-amber-900/70 text-sm leading-relaxed font-bold italic font-serif-church">探索 40 天旷野旅程背后的神学奥秘与教会传统。</p>
            </div>
            <div id="liturgy-info-list" class="space-y-12 pb-12"></div>
        </div>
    </main>

    <div id="exam-footer" class="fixed bottom-10 left-1/2 -translate-x-1/2 w-full max-w-sm px-6 hidden z-[110]">
        <div class="bg-indigo-950 text-white p-4 rounded-[2.5rem] shadow-2xl flex justify-between items-center border border-indigo-700 ring-4 ring-indigo-900/40">
            <div class="flex items-center gap-4 pl-2">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center font-black text-lg border-2 border-indigo-400/30 shadow-inner" id="exam-badge">0</div>
                <span class="text-[10px] font-black uppercase text-indigo-300 tracking-[0.1em] leading-tight">已记下罪项</span>
            </div>
            <div class="flex gap-2">
                <button onclick="copyConfessionList()" class="text-[10px] bg-indigo-500/20 px-4 py-2 rounded-full font-black hover:bg-indigo-500/40 transition-all border border-indigo-400/30 flex items-center gap-1.5"><i data-lucide="copy" class="w-3.5 h-3.5"></i> 复制</button>
                <button onclick="resetExam()" class="text-[10px] bg-red-500/20 px-4 py-2 rounded-full font-black hover:bg-red-500/40 transition-all border border-red-400/30 flex items-center gap-1.5"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i> 清空</button>
            </div>
        </div>
    </div>

    <div id="quote-card" class="fixed bottom-8 left-1/2 -translate-x-1/2 w-full max-w-md px-6 pointer-events-none transition-opacity duration-700 z-[120]">
        <div class="bg-white/95 backdrop-blur-2xl shadow-premium border border-violet-100 p-6 rounded-[3rem] flex items-center gap-6 pointer-events-auto border-t-8 border-t-violet-700">
            <div class="bg-violet-700 p-3 rounded-2xl text-white shadow-lg shadow-violet-200 flex-shrink-0"><i data-lucide="sparkles" class="w-5 h-5 animate-pulse"></i></div>
            <p id="daily-quote" class="text-xs font-black text-violet-950 leading-relaxed italic font-serif-church">“你们应回头改过，信从福音。”</p>
        </div>
    </div>

    <div id="error-output" class="hidden fixed inset-0 bg-white z-[9999] p-8 overflow-auto text-red-600 font-mono text-sm"></div>

    <script>
        // 错误捕获显示，避免白屏
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            document.getElementById('loading-screen').style.display = 'none';
            const errDiv = document.getElementById('error-output');
            errDiv.classList.remove('hidden');
            errDiv.innerHTML += `<p>Error: ${msg} <br>Line: ${lineNo}</p>`;
            return false;
        };

        // ================= 数据字典 =================
        const quotes = [
            "“记住：你原来是尘土，将来仍要归于尘土。”",
            "“斋戒不只是空肚子，更是为了腾出空间给天主。”",
            "“施舍不是给予我们多余的，而是分享我们必需的。”",
            "“祈祷是让天主的手去塑造我们的灵魂。”",
            "“在这个四旬期，让我们多一点仁慈，少一点评判。”",
            "“旷野不是惩罚，而是聆听天主微弱声音的圣殿。”",
            "“最大的禁食，是戒绝心中的骄傲与贪婪。”",
            "“基督的受难是爱的极致，我们的悔改是对爱的响应。”"
        ];

        const config = { 
            startDate: '2026-02-18', 
            milestones: [
                { offset: 0, title: '圣灰礼仪', date: '2/18' }, 
                { offset: 4, title: '第一主日', date: '2/22' }, 
                { offset: 11, title: '第二主日', date: '3/1' }, 
                { offset: 18, title: '第三主日', date: '3/8' }, 
                { offset: 25, title: '第四主日', date: '3/15' }, 
                { offset: 32, title: '第五主日', date: '3/22' }, 
                { offset: 39, title: '圣枝主日', date: '3/29' }, 
                { offset: 46, title: '复活主日', date: '4/5' }
            ] 
        };

        // 完整展开的 18 天修德计划
  // 完整展开的 47 天每日修德计划 (2026.02.18 - 2026.04.05)
        const dailyFullPlan = {
            "2026-02-18": { mentor: "【圣灰礼仪】灰烬的记号提醒我们生命的脆弱，也预示复活的新生。今日请深度默想这一场由尘土走向永恒的逾越。", p: "参与圣灰礼仪弥撒；阅读并默想玛窦福音 6:1-6", f: "全守大斋小斋：全日进一饱餐；禁食肉类及零食", a: "在圣堂慈善箱悄悄放入一笔款项，开始为期40天的爱德操练" },
            "2026-02-19": { mentor: "【旷野初探】耶稣被领入旷野。今日请刻意寻找一个物理上的‘安静角落’，听听被世俗掩盖的灵魂渴求。", p: "寻找苦像或圣体前练习15分钟绝对静默；慢诵天主经5遍", f: "戒绝今日所有的甜味饮品，回归纯净白水的简单", a: "对今天遇到的每一个为你服务的劳动者，致以注视眼睛的感谢" },
            "2026-02-20": { mentor: "【苦难周五】下午三点是主受难时刻。请暂时放下手中的繁忙，陪伴那位为我舍命的救主。", p: "15:00 准时参与堂区拜苦路善功与弥撒", f: "守小斋：戒食一切禽兽肉类；并斋戒今日的感官娱乐（不刷视频）", a: "为一位你曾有过嫌隙的邻人默默代祷，祈求和解的种子" },
            "2026-02-21": { mentor: "【省察日】主不嫌弃罪人。今日请对照‘告解全指南’，为您的灵魂举行一次大扫除。", p: "进行深度省察，准备办妥当告解；读圣咏第51篇", f: "今日不食用甜点，将饮食欲望控制在最基础的需求上", a: "整理家中不需要却长期占有的闲置物，计划捐赠" },
            "2026-02-22": { mentor: "【第一主日】主受试探。耶稣用圣言反击。反思：什么是我目前最大的试探？是名望、享乐还是控制欲？", p: "参与主日大礼弥撒；深度默想玛窦福音 4:1-11", f: "主日不强制禁食，但在社交媒体和言语上保持节制", a: "全心陪伴家人，在这段时间内完全关闭手机通知" },
            "2026-02-23": { mentor: "【修德：谦卑】魔鬼诱惑主炫耀神迹。今日即便你完成了一项伟大的工作，也要在心中说：‘我是无用的仆人’。", p: "诵念圣母七苦经一段；默想圣母的低微与顺服", f: "言语斋戒：今日不发表任何‘评价他人’的言论", a: "秘密地为同事或家人完成一件繁琐的小事，不让对方察觉" },
            "2026-02-24": { mentor: "【修德：慷慨】白白得来的，也要白白分施。不仅是金钱，更是你的时间与耐心。", p: "为堂区神父及福传事业代祷；读经15分钟", f: "感官斋戒：今日绝不点开任何娱乐爆料或八卦新闻", a: "在工作中多帮助一位新手，或耐心解答他人的疑问" },
            "2026-02-25": { mentor: "【修德：温良】温良的人是有福的。在快节奏的生活中，你的温和是天主临在的标记。", p: "默想耶稣为门徒洗脚的场景；练习5分钟呼吸祈祷", f: "脾气斋戒：今日无论遇到什么急事，都不用急躁或嘲讽的语气", a: "主动去关心一位平时在团体中被边缘化或被忽视的人" },
            "2026-02-26": { mentor: "【修德：信靠】焦虑是对天主缺乏信任的表现。今日请将一切担忧交托在祂手中。", p: "在圣体前或安静处静默20分钟；反复复述‘耶稣我信靠祢’", f: "物资节制：今日不打开任何购物软件，不浏览商品", a: "向一位久未联络、可能正处于低谷的朋友发去问候" },
            "2026-02-27": { mentor: "【苦难周五】十字架的道路是窄路。今日请陪伴走在加尔瓦略山上的主。", p: "15:00 参与堂区拜苦路；默想第十一处（主被钉十字架）", f: "守小斋：禁食肉类；进食时保持内心的刻苦与感恩", a: "为医院里受病苦折磨的病人，以及失业焦虑者献上今日的苦路" },
            "2026-02-28": { mentor: "【修德：纯洁】心里洁净的人是有福的，因为他们要看见天主。净化我们的记忆与幻想。", p: "诵念玫瑰经（欢喜五端），求圣母赐予身心的纯洁", f: "目光斋戒：控制眼睛不看不洁、不健康或引发嫉妒的内容", a: "为那些陷入色情或感官瘾癖无法自拔的灵魂献上祈祷" },
            "2026-03-01": { mentor: "【第二主日：显容】在平凡生活中寻找主的荣光。苦难不是终点，复活的真光已在山上显现。", p: "参与主日弥撒；默想玛 17:1-9，认出生活中的主", f: "主日守主日之乐，但在饮食上不过度放纵", a: "致电远方父母或探望长辈，将喜乐带给他们" },
            "2026-03-02": { mentor: "【修德：听命】‘这是我的爱子，你们要听从他。’顺服是打破骄傲的最佳武器。", p: "默读若望福音 6章，聆听主关于生命之粮的教导", f: "自我斋戒：今日放弃一次在争论中‘非要赢’的执念", a: "顺服家人或上司的一个合理但你不喜欢的建议" },
            "2026-03-03": { mentor: "【修德：忍耐】农夫耐心等待地里的出产。灵性成长也需要时间的浇灌。", p: "在面对烦躁时，缓慢念三遍《圣三光荣经》", f: "时间斋戒：今日不催促别人，接受生活中的等待和延误", a: "对一位动作慢的服务员或老人展现出极大的耐心" },
            "2026-03-04": { mentor: "【修德：感恩】抱怨是毒药，感恩是解药。不要只看到失去的，要看到拥有的。", p: "晚间省察：写下今天主赐予的三个具体恩典，并献上感谢", f: "言语斋戒：今日绝不说一句抱怨天气、交通或工作的怨言", a: "对一位习惯默默付出的人（如保洁员、门卫）表达真诚感谢" },
            "2026-03-05": { mentor: "【修德：同理心】与喜乐者同乐，与泣者同泣。走出自我的孤岛。", p: "为世界上的难民、战乱地区的无辜平民祈祷10分钟", f: "评判斋戒：当你想在心里批评某人时，立刻停下并为他祈祷", a: "耐心倾听他人的诉说，不急于打断，也不急于给建议" },
            "2026-03-06": { mentor: "【苦难周五】祂的面容被毁，以至于人们掩面不顾。在弱小者身上认出受苦的基督。", p: "15:00 参与堂区拜苦路；默想第六处（圣妇拭圣面）", f: "守小斋：戒食肉类；将省下的饭钱用于奉献", a: "对乞讨者或处于弱势的人展现出尊重，不带鄙夷" },
            "2026-03-07": { mentor: "【修德：喜乐】基督徒的喜乐是在苦难中依然有盼望。不要做一个愁眉苦脸的悔改者。", p: "诵念玫瑰经（荣福五端），默想天堂的永恒福乐", f: "忧虑斋戒：拒绝沉溺于对未来的担忧，活在当下的恩典中", a: "给家里带来笑声，主动承担家务并保持愉悦的心情" },
            "2026-03-08": { mentor: "【第三主日：活水】主啊，请赐我永不干涸的活水。我们常在世俗的井里打水，却越喝越渴。", p: "参与主日弥撒；深度默想若 4:5-42 (撒玛黎雅妇人)", f: "减少感官消遣（如短视频），增加深度属灵阅读的时间", a: "为堂区福传项目提供协助，或向非教友分享一段信仰感悟" },
            "2026-03-09": { mentor: "【修德：坦诚】在光中行走。天主深知我们的一切，隐藏毫无意义。", p: "在祈祷中向天主承认一个你一直试图隐藏的弱点或执念", f: "面子斋戒：承认自己今天犯的一个小错误，不推诿", a: "如果与某人有误会，主动找对方坦诚沟通，化解芥蒂" },
            "2026-03-10": { mentor: "【修德：专一】不能事奉天主，又事奉财富。检查心中的首要位置留给了谁。", p: "检查自己的财务状况与消费习惯，求主赐予神贫的精神", f: "物欲斋戒：整理衣柜，找出闲置衣物，克制购买新衣的冲动", a: "将一笔原本打算用于享乐的资金，捐献给教会或穷人" },
            "2026-03-11": { mentor: "【修德：温柔】以柔克刚。天主在微风中向厄里亚显现，而非狂风暴雨。", p: "默想耶稣对罪妇的温柔；求主赐我一颗肉做的心", f: "情绪斋戒：在家人发脾气时，保持沉默与温柔，不以暴制暴", a: "用最温柔的声音和态度去安抚一个正在哭闹的孩子或焦虑的人" },
            "2026-03-12": { mentor: "【修德：节制】身体是圣神的宫殿。节制不是惩罚，而是为了重获自由。", p: "求圣神赐予节制的果实；晚间睡前谢绝手机干扰，专心祈祷", f: "饮食节制：晚餐只吃七分饱，感受轻微的饥饿，以此纪念饥民", a: "谢绝一个不必要的饭局，将时间留给家庭或阅读" },
            "2026-03-13": { mentor: "【苦难周五】主三次跌倒，却依然站起走向加尔瓦略。不要在修德的路上轻言放弃。", p: "15:00 参与拜苦路；默想第九处（耶稣第三次跌倒）", f: "守小斋：禁肉食；无论今天多累，坚持完成定下的微小克己", a: "鼓励一个正在面临失败或想要放弃的人，给他支撑的力量" },
            "2026-03-14": { mentor: "【修德：宽恕】‘你们不宽恕人，天父也不宽恕你们的过错。’拔除心中的毒根。", p: "在苦像前，大声说出那个曾伤害你的人的名字，并宣告宽恕", f: "记忆斋戒：当脑海中浮现过去的旧账和伤害时，立刻转移注意力", a: "为那个你最难原谅的人做一件善事（哪怕只是点个赞或默默祝福）" },
            "2026-03-15": { mentor: "【第四主日：复明】主，请开启我灵魂的眼。本周是喜乐主日，在悔改中瞥见曙光。", p: "参与主日弥撒；默想若 9:1-41 (胎生瞎子复明)", f: "保持生活简朴，但在心中点燃对复活节临近的喜乐", a: "关注身边的困难者，用天主的爱去照亮他们生命中的盲区" },
            "2026-03-16": { mentor: "【修德：觉察】世界充满了天主的痕迹，盲目的人却什么也看不见。", p: "在下班或回家的路上，放下手机，静心观察大自然，赞美造物主", f: "噪音斋戒：今天上下班途中不听音乐或播客，保持内心的安静", a: "发现家人或同事的一个小改变（如换了发型、做了新菜），并真诚赞美" },
            "2026-03-17": { mentor: "【修德：纯正意向】你所做的善事，是为了天主，还是为了引人注目？", p: "反省自己最近行善的动机；求主赐予单纯如鸽子的心", f: "虚荣斋戒：今天如果在工作或善事上取得了成绩，刻意保持低调", a: "做一件没人会发现、更没人会感谢的家务（如清理下水道）" },
            "2026-03-18": { mentor: "【修德：交托】天主的安排永远比我们的计划更好。学会放手。", p: "将目前最困扰你的一个难题，在祈祷中彻底交托给圣母", f: "控制欲斋戒：今天允许事情不按你的计划发展，不发怒", a: "信任他人的能力，将一项原本想自己掌控的工作放权给别人" },
            "2026-03-19": { mentor: "【大圣若瑟瞻礼】效法圣大若瑟的沉默、服从与顾家。他是劳动者的主保。", p: "参与大圣若瑟瞻礼弥撒；为全世界的父亲及劳工祈祷", f: "瞻礼日可免斋；但在工作中效法圣若瑟的勤恳与无怨", a: "给父亲打个电话，或者为家庭默默完成一项体力劳动" },
            "2026-03-20": { mentor: "【苦难周五】十字架旁的圣母。她的心被利剑刺透，却屹立不倒。", p: "15:00 参与拜苦路；诵念《痛苦圣母经》或玫瑰经痛苦五端", f: "守小斋：禁肉食；陪伴圣母的哀痛", a: "探望一位失去亲人或处于极大悲痛中的教友" },
            "2026-03-21": { mentor: "【修德：醒寤】‘你们不知道主什么时候来到。’保持灵魂的警醒。", p: "进行深度办告解的最后准备，反省是否有漏告的重罪", f: "舒适斋戒：今晚比平时早睡，明早提早15分钟起床祈祷", a: "为处于临终状态的灵魂献上慈悲串经" },
            "2026-03-22": { mentor: "【第五主日：复活预兆】主呼唤拉匝禄走出坟墓。这也是对被罪恶缠绕的我们的呼唤。", p: "参与主日弥撒；深度默想若 11:1-45 (拉匝禄复活)", f: "立志在复活节前彻底改掉一个深陷的恶习，求主解开束缚", a: "为教友中的病弱者祈祷，将复活的盼望带给他们" },
            "2026-03-23": { mentor: "【修德：弃绝】‘若有人要跟从我，就当舍己。’解开缠住灵魂的绷带。", p: "检查自己最难割舍的世俗执念，祈求主赐予割舍的勇气", f: "习惯斋戒：今天刻意打破一个舒适的小习惯（如不喝平时爱喝的咖啡）", a: "把平时不愿分享的资源或知识，慷慨地分享给有需要的人" },
            "2026-03-24": { mentor: "【修德：敬畏】天主是慈爱的，也是至尊的。不可将祂的仁慈视为放纵的借口。", p: "在进入圣堂时，进行一个深深的朝拜；重温天主十诫", f: "轻浮斋戒：今天不开任何低级或轻浮的玩笑，保持言辞的庄重", a: "在公共场合保持良好的礼仪，彰显基督徒的教养" },
            "2026-03-25": { mentor: "【预报救主降生瞻礼】‘看，天主的婢女，愿照祢的话成就于我吧！’", p: "参与瞻礼弥撒；诵念三钟经，默想‘圣言成了血肉’的奥迹", f: "大瞻礼免斋；欢庆降生奥迹的开始", a: "为孕妇及所有保护胎儿生命的反堕胎组织祈祷与奉献" },
            "2026-03-26": { mentor: "【修德：勇敢】在冷漠的世界里逆流而上。为真理作证需要殉道者的勇气。", p: "阅读一位致命圣人的传记；求圣神赐予明认信仰的勇敢", f: "从众斋戒：在今天群体讨论中，当遇到违背道德的事，敢于表达不同意见", a: "在餐厅用餐前后，勇敢而自然地画十字圣号祈祷" },
            "2026-03-27": { mentor: "【苦难周五】圣周即将到来。加尔瓦略山的阴影已笼罩大地。", p: "15:00 参与拜苦路；默想主被钉死的剧痛", f: "守小斋：禁肉食；在此日务必完成四旬期的妥当告解", a: "减少一切无谓的社交，进入准备圣周的静默期" },
            "2026-03-28": { mentor: "【修德：退隐】在暴风雨来临前，主常退避到寂静处。收拾心灵迎接圣周。", p: "用半小时安静阅读受难史（玛窦福音 26-27章）", f: "信息斋戒：从今晚起至复活节，大幅减少所有非工作必要的社交媒体使用", a: "将会场、家庭或圣堂打扫干净，准备迎接主枝主日" },
            "2026-03-29": { mentor: "【圣枝主日】贺三纳！欢迎君王进城。但今天欢呼的人群，明天是否会喊‘钉死他’？", p: "参与圣枝主日礼仪；带圣枝回家置于苦像旁；默想长篇受难史", f: "停止不必要的社交聚会，与主同入耶路撒冷", a: "宽恕并原谅一位曾深深伤害过你的人，不带任何条件" },
            "2026-03-30": { mentor: "【圣周一】伯达尼的玛利亚倾倒了珍贵的香液。你为爱主保留了什么？", p: "默想若望福音 12:1-11；反省我对天主的爱是否计较成本", f: "奢华斋戒：今日饮食极简，不点外卖，不吃任何昂贵的食物", a: "像倾倒香液一样，为天主或家人做一件毫无保留的付出" },
            "2026-03-31": { mentor: "【圣周二】犹达斯出卖了主。检查我们在金钱、利益面前，是否有出卖信仰的念头。", p: "默想若望福音 13:21-33；在主前诚实面对自己的软弱与贪婪", f: "贪念斋戒：拒绝任何占小便宜的冲动", a: "主动向你曾经亏欠过的人（物质或情感上）做出补偿" },
            "2026-04-01": { mentor: "【圣周三】被称为‘间谍星期三’。犹达斯与大祭司达成三十块银钱的交易。", p: "默想玛窦福音 26:14-25；求主保守我永远忠诚于祂", f: "娱乐斋戒：彻底隔绝一切影视、游戏娱乐，进入至深哀恸", a: "如果还没有办告解，这是最后的时机。帮助身边教友去办告解" },
            "2026-04-02": { mentor: "【圣周四：最后晚餐】主设立了圣体圣事，并跪下为门徒洗脚。伟大的爱！", p: "参与建立圣体弥撒；今夜参与朝拜圣体直到深夜（陪伴山园中的主）", f: "晚餐后保持绝对静默，体会在革责玛尼庄园的孤独", a: "效法基督洗脚：在家中承担最卑微、最脏的家务，服侍家人" },
            "2026-04-03": { mentor: "【圣周五：救主受难】全地黑暗。天主为人类而死。在十字架下，一切言语都是苍白的。", p: "参与主受难日礼仪（朝拜十字架）；下午三点保持绝对静默与下跪", f: "严守大斋及小斋：仅进一顿素餐，体会肉身的极度匮乏", a: "为世界上最绝望、最痛苦的灵魂，以及不认识主的人献上克己" },
            "2026-04-04": { mentor: "【圣周六：安息守夜】在空荡的祭台前，万籁俱寂。主在坟墓中安息，救拔古圣。期待真光！", p: "白天保持圣墓旁的静默；晚上全程参与隆重的逾越节守夜礼", f: "建议白天继续保持小斋的克苦，直到守夜礼光荣的阿肋路亚响起", a: "在守夜礼上，以最饱满的热情重申洗礼誓愿，欢迎新领洗的教友" },
            "2026-04-05": { mentor: "【复活大瞻礼】阿肋路亚！主真的复活了！死亡被彻底击败！这是我们信仰的核心。", p: "参与隆重复活弥撒；领受复活的圣体，充满真光的喜乐", f: "斋戒正式结束！与家人共同分享丰盛的复活大餐，庆祝胜利", a: "将复活的喜讯带给邻人，从此立志活出充满希望、死于罪恶的光明生活！" }
        };

        // 完整展开的 6 周大纲
        const weeklyFullData = [
            { 
                week: "第一周", theme: "旷野与诱惑", focus: "分辨诱惑，操练自制。", scripture: "玛 4:1-11", 
                intro: "跟随耶稣进入旷野。我们要学习用圣言来抵挡‘肉欲、虚荣与权力’这三大诱惑。", 
                days: [
                    "主日：【福音】耶稣在旷野。焦点：识别生命中的‘假神’。",
                    "周一：【灵修指引】练习‘识别虚荣’，选择神圣的沉默。",
                    "周二：【灵修指引】练习‘物欲节制’，拒绝非必需品。",
                    "周三：【灵修指引】练习‘诚实’，在琐事上绝不说谎。",
                    "周四：【灵修指引】练习‘代祷’，为深陷网瘾者祈祷。",
                    "周五：【受难】参与拜苦路，感受十字架的沉重。",
                    "周六：【谦卑】练习‘无名善行’，做好事且不让人知。"
                ] 
            },
            { 
                week: "第二周", theme: "显容与光荣", focus: "在苦难阴影中仰望真光。", scripture: "玛 17:1-9", 
                intro: "显容是为了告诉门徒：苦难不是终点。我们要练习在琐碎暗淡的生活里，认出基督的荣光。", 
                days: [
                    "主日：【福音】山上显容。焦点：在平凡中认出主的荣光。",
                    "周一：【灵修指引】信心操练：沮丧时复述‘主，我相信祢。’",
                    "周二：【灵修指引】心境整理：摒弃焦虑杂念，交托给天主。",
                    "周三：【灵修指引】分享真光：探望灰心丧志的教友。",
                    "周四：【灵修指引】听命练习：顺服一个你不喜欢的善意建议。",
                    "周五：【受难】参与拜苦路。默想荣光背后的荆棘。",
                    "周六：【渴望】深度自省：我对复活节新生命的渴望真切吗？"
                ] 
            },
            { 
                week: "第三周", theme: "活水与渴望", focus: "承认干涸，寻求基督活水。", scripture: "若 4:5-42", 
                intro: "如同井边的妇人，我们常在世俗的井里寻找解渴的水，却越喝越渴。本周请坦诚面对内心的干涸，让基督的活水来填满。", 
                days: [
                    "主日：【福音】井边对话。焦点：我生命中那些无法让我真正满足的“世俗之水”是什么？",
                    "周一：【灵修指引】今日练习‘坦诚’。向天主承认一个隐藏的弱点。",
                    "周二：【灵修指引】今日练习‘解渴’。用阅读圣经替代刷手机解闷。",
                    "周三：【灵修指引】今日练习‘见证’。找机会向身边的人分享天主的恩宠。",
                    "周四：【灵修指引】今日练习‘专注’。每次喝水都默念：“主，请赐我活水。”",
                    "周五：【受难】参与拜苦路。默想耶稣在十字架上那句“我渴”。",
                    "周六：【渴望】深度自省：我的信仰生活是对主充满热情的渴望吗？"
                ] 
            },
            { 
                week: "第四周", theme: "光明与盲目", focus: "医治属灵盲目，行在光明中。", scripture: "若 9:1-41", 
                intro: "“我是世界的光。”本周是喜乐主日，在悔改中我们瞥见复活曙光。求主开启我们信德的盲眼。", 
                days: [
                    "主日：【福音】瞎子复明。焦点：承认自己的盲目，不急于评判他人。",
                    "周一：【灵修指引】今日练习‘不评判’。想批评某人时立刻停下。",
                    "周二：【灵修指引】今日练习‘光明’。刻意找寻并赞美三个人身上的优点。",
                    "周三：【灵修指引】今日练习‘醒觉’。闭眼一分钟后，感谢平凡恩典。",
                    "周四：【灵修指引】今日练习‘听命’。绝对顺服长上的一个合理要求。",
                    "周五：【受难】参与拜苦路。求主光照我的愚昧与冷漠。",
                    "周六：【谦卑】深度自省：我是否常常自以为是而拒绝了天主的纠正？"
                ] 
            },
            { 
                week: "第五周", theme: "死亡与生命", focus: "死于旧我，解开罪恶束缚。", scripture: "若 11:1-45", 
                intro: "耶稣呼唤拉匝禄走出坟墓。这也是对我们被罪恶缠绕的灵魂的呼唤。准备好抛弃缠带了吗？", 
                days: [
                    "主日：【福音】拉匝禄复活。焦点：我生命中哪些部分需要基督来复苏？",
                    "周一：【灵修指引】今日练习‘痛悔’。深究自己最深沉的罪，呼求耶稣。",
                    "周二：【灵修指引】今日练习‘解绑’。戒除一个依赖的小习惯（如熬夜）。",
                    "周三：【灵修指引】今日练习‘希望’。去安慰一个经历挫折悲伤的人。",
                    "周四：【灵修指引】今日练习‘信赖’。面对难题复述：“主，我知道祢能。”",
                    "周五：【受难】参与拜苦路。默想：基督为我们尝了死味。",
                    "周六：【准备】深度自省：我的心准备好与主同死同葬了吗？"
                ] 
            },
            { 
                week: "圣周", theme: "逾越与救赎", focus: "紧紧跟随，陪主走完最后旅程。", scripture: "玛 26:14-27:66", 
                intro: "这一周，请推掉不必要的应酬。保持内心的极度安静，与主同赴圣筵，同赴苦架。", 
                days: [
                    "主日：【圣枝主日】欢呼。反思：我欢呼祂为王，明天是否会出卖祂？",
                    "周一：【灵修指引】今日练习‘倾其所有的爱’。为天主或家人做毫无保留的付出。",
                    "周二：【灵修指引】今日练习‘警醒’。检查在利益前是否有妥协底线的念头。",
                    "周三：【灵修指引】今日练习‘忠诚’。务必在今日或之前完成妥当告解。",
                    "周四：【建立圣体】主为我洗脚，我愿意洗仇人的脚吗？今夜朝拜圣体。",
                    "周五：【主受难日】全日守大小斋。下午3点绝对静默。",
                    "周六：【安息守夜】今晚参与守夜礼，更新洗礼誓愿，迎接真光复活！"
                ] 
            }
        ];

        // 完整展开的 14 处苦路
        const stationsDetailed = [
            { id: 1, title: "第一处", name: "耶稣判死刑", scripture: "“彼拉多把耶稣交出来钉在十字架上。” (玛27:26)", med: "主，在不义的审判面前祢保持了神圣的静默。求祢治愈我那颗爱面子胜过爱真理的心。", prayer: "主耶稣，求祢赐我勇气，不顾世俗评判为祢作证。阿们。", res: "今日定志：绝不说任何违背良知的辩解之词。" },
            { id: 2, title: "第二处", name: "耶稣背苦架", scripture: "“耶稣自己背着十字架出来...” (若19:17)", med: "祢没有抱怨，而是以此作为救赎。请教导我带着爱去接纳无法改变的人生重担。", prayer: "主耶稣，请赐我接纳的恩宠，在琐碎中看见希望。阿们。", res: "今日定志：不抱怨遇到的繁琐工作或突发事件。" },
            { id: 3, title: "第三处", name: "耶稣一跌倒", scripture: "“祂实在承担了我们的疾苦。” (依53:4)", med: "跌倒并不可怕，可怕的是沉溺于绝望。主，当我因罪反复跌倒时，求祢拉我一把。", prayer: "主耶稣，求祢在我软弱时做我支柱，赐我重新站起的坚韧。阿们。", res: "今日定志：针对一个常犯的小毛病进行三次主动克制。" },
            { id: 4, title: "第四处", name: "耶稣遇圣母", scripture: "“有一把利剑要刺透你的心灵。” (路2:35)", med: "圣母陪伴主走苦路。圣母，请在我的苦路上也陪伴着我。", prayer: "至圣童贞玛利亚，在我灰心时领我走向耶稣。阿们。", res: "今日定志：主动致电父母长辈，并为已故教友祈祷。" },
            { id: 5, title: "第五处", name: "西满助耶稣", scripture: "“他们叫西满背起十字架，跟在耶稣后面。” (路23:26)", med: "我愿意在小事上分担近人的负担吗？哪怕只是微不足道的杂活。", prayer: "主耶稣，除去我的自私，让我在别人需要时挺身而出。阿们。", res: "今日定志：额外帮家人或同事分担一项琐事。" },
            { id: 6, title: "第六处", name: "圣妇拭圣面", scripture: "“主，我要寻求祢的面。” (咏27:8)", med: "维罗尼卡印下了爱。面对社会的冷漠，我愿意成为那方温柔的手帕吗？", prayer: "主耶稣，将祢的圣容印在我的灵魂里。阿们。", res: "今日定志：对每一位提供服务的人露出诚挚微笑。" },
            { id: 7, title: "第七处", name: "耶稣二跌倒", scripture: "“凡是自卑的，必被提升。” (路14:11)", med: "圣德是无数次失败后的坚持。主，求赐我持久的恒心。", prayer: "主耶稣，赐我坚持的恒心，不在修行路上半途而废。阿们。", res: "今日定志：无论多忙，都要高质量完成读经计划。" },
            { id: 8, title: "第八处", name: "耶稣劝妇女", scripture: "“不要为我哭，应为你们和你们的孩子哭。” (路23:28)", med: "教导我为世界之罪而悔恨，不忽视在死亡边缘挣扎的灵魂。", prayer: "主耶稣，扩大我的心胸，为罪人献上代祷。阿们。", res: "今日定志：戒掉一项娱乐，专心为世界和平代祷。" },
            { id: 9, title: "第九处", name: "耶稣三跌倒", scripture: "“我的能力在软弱中才全显出来。” (格后12:9)", med: "主是绝望者最后的唯一依恃。求主赐我在绝处依然信靠主恩。", prayer: "主耶稣，在人生的尽头做我的支柱。阿们。", res: "今日定志：在最疲惫发怒的瞬间，先默念‘主，救我。’" },
            { id: 10, title: "第十处", name: "耶稣被剥衣", scripture: "“他们分了我的衣服，为我的长衣抽了签。” (咏22:19)", med: "求主剥去我的虚荣心和对物质的病态贪恋，让我赤诚见祢。", prayer: "主耶稣，剥去我的虚假，让我诚实承认罪过。阿们。", res: "今日定志：清理一件因贪欲而占有的多余物品。" },
            { id: 11, title: "第十一处", name: "耶稣钉架上", scripture: "“父啊，宽赦他们吧！因为他们不知道他们做的是什么。” (路23:34)", med: "主在剧痛中选择了宽恕。请拔除我心中不愿原谅他人的钉子。", prayer: "主耶稣，治愈我仇恨的伤疤，赐我原谅他人的力量。阿们。", res: "今日定志：在心中诚挚地对曾伤害我的人说‘我宽恕你’。" },
            { id: 12, title: "第十二处", name: "耶稣死架上", scripture: "“父啊！我把我的灵魂交托在祢手中。” (路23:46)", med: "天主为我而死。还有什么计较放不下呢？愿祢的死成为我苏醒的起点。", prayer: "主耶稣，愿祢的死亡成为我的新生。阿们。", res: "今日定志：下午3点，面向苦像保持3分钟绝对静默。" },
            { id: 13, title: "第十三处", name: "耶稣下苦架", scripture: "“若瑟领下了耶稣的遗体。” (路23:50-53)", med: "求主使我在丧恸时，能紧紧靠在圣母怀里，托付主旨。", prayer: "圣母玛利亚，在人生的终点领我回到耶稣怀抱。阿们。", res: "今日定志：诵念经文，为已故恩人及教友祈祷。" },
            { id: 14, title: "第十四处", name: "耶稣葬于墓", scripture: "“他在坟墓门口滚上一块大石头，就走了。” (玛27:60)", med: "坟墓是复活的摇篮。我在大石头后等待，带着满怀的希望。", prayer: "主耶稣，守护我的信心，预见复活。阿们。", res: "今日定志：写下一件期待在复活节改过的志向存入圣经。" }
        ];

        // 完整展开的、具有嵌套结构的告解省察及流程数据
        const confessionContentData = {
            examGroups: [
                {
                    groupTitle: "天主十诫",
                    groupDesc: "这是天主颁布给人类的道德总纲。检查我们在思想、言语和行为上，是否违背了对天主的爱（前三诫）和对近人的爱（后七诫）。",
                    sections: [
                        { 
                            subtitle: "第一诫：钦崇一天主在万有之上", 
                            items: [
                                { q: "我是否忽略了每日的祈祷？", id: "c1_1" }, 
                                { q: "我是否参与过迷信活动（如算命、风水、星座运势决定行动、占卜）？", id: "c1_2" }, 
                                { q: "我是否把金钱、工作、名声或权力看得比天主更重要？", id: "c1_3" }, 
                                { q: "我是否故意怀疑天主的道理或存在？", id: "c1_4" }
                            ] 
                        },
                        { 
                            subtitle: "第二诫：毋呼天主圣名以发虚誓", 
                            items: [
                                { q: "我是否在愤怒或开玩笑时乱用天主或耶稣的圣名？", id: "c2_1" }, 
                                { q: "我是否指着天主发誓却不履行？", id: "c2_2" }, 
                                { q: "我是否对圣人、圣经或神圣的事物表现不敬？", id: "c2_3" }
                            ] 
                        },
                        { 
                            subtitle: "第三诫：守瞻礼之日", 
                            items: [
                                { q: "我是否在主日（星期天）及当守瞻礼日无故缺席弥撒？", id: "c3_1" }, 
                                { q: "我是否在弥撒中故意分心、玩手机或迟到早退？", id: "c3_2" }, 
                                { q: "我是否在主日做不必要的重体力劳动或商业活动，忽略了身心的休息和陪伴家人？", id: "c3_3" }
                            ] 
                        },
                        { 
                            subtitle: "第四诫：孝敬父母", 
                            items: [
                                { q: "我是否不尊重父母，对他们发脾气或顶撞？", id: "c4_1" }, 
                                { q: "当父母年老或生病时，我是否忽略了照顾他们的责任？", id: "c4_2" }, 
                                { q: "作为父母，我是否忽略了子女的信仰教育和情感需求？", id: "c4_3" }
                            ] 
                        },
                        { 
                            subtitle: "第五诫：毋杀人", 
                            items: [
                                { q: "我是否心存恨意、嫉妒或长期不愿宽恕他人？", id: "c5_1" }, 
                                { q: "我是否在言语（谩骂、讽刺）或肢体上伤害过他人？", id: "c5_2" }, 
                                { q: "我是否曾堕胎、协助堕胎或赞同安乐死？", id: "c5_3" }, 
                                { q: "我是否过度饮酒、吸毒、暴饮暴食或伤害自己的身体健康？", id: "c5_4" }
                            ] 
                        },
                        { 
                            subtitle: "第六诫：毋行邪淫", 
                            items: [
                                { q: "我是否观看色情图片、书刊或影片？", id: "c6_1" }, 
                                { q: "我是否犯过手淫（自慰）的罪？", id: "c6_2" }, 
                                { q: "我是否发生过婚前性行为或婚外情？", id: "c6_3" }, 
                                { q: "我的穿着或举止是否轻浮，引诱他人犯罪？", id: "c6_4" }
                            ] 
                        },
                        { 
                            subtitle: "第七诫：毋偷盗", 
                            items: [
                                { q: "我是否偷拿过不属于我的钱财或物品？", id: "c7_1" }, 
                                { q: "我是否归还了借用的物品或金钱？", id: "c7_2" }, 
                                { q: "我是否在工作中偷懒、虚报工时或通过欺骗获取利益？", id: "c7_3" }, 
                                { q: "我是否故意损坏公物或他人的财物？", id: "c7_4" }
                            ] 
                        },
                        { 
                            subtitle: "第八诫：毋妄证", 
                            items: [
                                { q: "我是否说过谎话欺骗他人？", id: "c8_1" }, 
                                { q: "我是否散播谣言、诽谤或破坏他人的名声？", id: "c8_2" }, 
                                { q: "我是否泄露了他人的秘密？", id: "c8_3" }, 
                                { q: "我是否做伪证或断章取义冤枉他人？", id: "c8_4" }
                            ] 
                        },
                        { 
                            subtitle: "第九诫：毋贪他人妻", 
                            items: [
                                { q: "我是否故意在脑海中保留不洁的思想或幻想？", id: "c9_1" }, 
                                { q: "我是否用贪婪淫乱的眼光看待异性？", id: "c9_2" }, 
                                { q: "我是否渴望破坏他人的婚姻或情感关系？", id: "c9_3" }
                            ] 
                        },
                        { 
                            subtitle: "第十诫：毋贪他人财物", 
                            items: [
                                { q: "我是否过度贪恋物质享受？", id: "c10_1" }, 
                                { q: "我是否嫉妒别人的财富、才华或成功？", id: "c10_2" }, 
                                { q: "我是否因为别人拥有我没有的东西而感到难过或愤恨？", id: "c10_3" }
                            ] 
                        }
                    ]
                },
                {
                    groupTitle: "圣教会四规",
                    groupDesc: "这是身为教会肢体应当履行的基本义务，保障我们的灵性生命能够通过礼仪、圣事和克己生活持续成长。",
                    sections: [
                        { 
                            subtitle: "第一规：凡主日及一总停工瞻礼，当参予全弥撒", 
                            items: [
                                { q: "我是否无故缺席主日弥撒？", id: "p1_1" }, 
                                { q: "我是否在弥撒中迟到早退，没有参与“全”弥撒？", id: "p1_2" }
                            ] 
                        },
                        { 
                            subtitle: "第二规：遵守圣教会所定的大小斋期", 
                            items: [
                                { q: "我是否在圣灰礼仪日和耶稣受难日遵守了大小斋？", id: "p2_1" }, 
                                { q: "我是否在每星期五遵守了小斋（不食肉），或以其他克己善工代替？", id: "p2_2" }
                            ] 
                        },
                        { 
                            subtitle: "第三规：当至少每年一次妥当告解并领圣体", 
                            items: [
                                { q: "我是否超过一年没有办告解？", id: "p3_1" }, 
                                { q: "我是否在身负大罪（重罪）的情况下仍冒领圣体？", id: "p3_2" }
                            ] 
                        },
                        { 
                            subtitle: "第四规：当尽力帮助圣教会的经费", 
                            items: [
                                { q: "我是否依照自己的能力，奉献金钱或时间支持教会的发展？", id: "p4_1" }
                            ] 
                        }
                    ]
                },
                {
                    groupTitle: "七罪宗",
                    groupDesc: "这七种罪源是其他许多罪过的根子。省察七罪宗能挖掘犯罪的动机和倾向，治愈心灵的痼疾。",
                    sections: [
                        { 
                            subtitle: "骄傲 (Pride) & 悭吝 (Greed)", 
                            items: [
                                { q: "我是否自视过高，看不起别人？为了虚荣而行动，渴望别人的赞美？", id: "s1_1" }, 
                                { q: "我是否拒绝接受别人的建议或批评？", id: "s1_2" }, 
                                { q: "我是否过度看重金钱，甚至为此牺牲道德原则？对穷人硬着心肠不愿施舍？", id: "s2_1" }
                            ] 
                        },
                        { 
                            subtitle: "迷色 (Lust) & 愤怒 (Wrath)", 
                            items: [
                                { q: "我是否把他人仅仅视为满足欲望的工具？沉溺于感官快乐而忽略爱的责任？", id: "s3_1" }, 
                                { q: "我是否经常情绪失控伤害身边的人？内心充满怨恨拒绝宽恕？", id: "s4_1" }
                            ] 
                        },
                        { 
                            subtitle: "贪饕 (Gluttony) & 嫉妒 (Envy)", 
                            items: [
                                { q: "我是否对饮食毫无节制，暴饮暴食？", id: "s5_1" }, 
                                { q: "我是否见不得别人好？在背后说人坏话，贬低他人成就？对别人不幸幸灾乐祸？", id: "s6_1" }
                            ] 
                        },
                        { 
                            subtitle: "懒惰 (Sloth)", 
                            items: [
                                { q: "我是否在灵修生活（祈祷、读经）上懒散懈怠？", id: "s7_1" }, 
                                { q: "我是否逃避自己应尽的工作、家庭或学业责任，虚度光阴？", id: "s7_2" }
                            ] 
                        }
                    ]
                }
            ],
            steps: [
                { 
                    t: "1. 进入与画十字圣号", 
                    d: "进入告解亭（跪下或坐下），向神父问好，然后一起画十字圣号：‘因父、及子、及圣神之名。阿们。’" 
                },
                { 
                    t: "2. 开场白", 
                    d: "告诉神父你距离上次告解有多久：‘请神父降福，我罪人愿在教会内悔改。我上次告解是在（例如：一个月前 / 很久以前）。’" 
                },
                { 
                    t: "3. 告明罪过", 
                    d: "诚实地说出省察出来的罪过。对于大罪，最好说明次数和情节。结束时说：‘还有我省察不到的罪，也都求神父宽恕。’" 
                },
                { 
                    t: "4. 接受教导与补赎", 
                    d: "神父会给你一些劝导，并给你指定“补赎”（通常是几遍经文或一件善行）。仔细聆听，并记住补赎内容。" 
                },
                { 
                    t: "5. 诵念痛悔经 & 赦罪", 
                    d: "神父会邀请你念《痛悔经》。当神父念赦罪经说到‘我因父、及子、及圣神之名，赦免你的罪’时，你答：‘阿们’并画十字。" 
                },
                { 
                    t: "6. 礼成", 
                    d: "神父通常会说：‘天主已经宽恕了你，平平安安回去吧。’ 你答：‘感谢天主。’ 离开后记得去圣堂内完成补赎并感谢天主。" 
                }
            ]
        };

        const holyWeekPlan = [
            { 
                day: "圣枝主日 (3/29)", title: "基督受难主日", focus: "欢迎和平之王进城奉献。礼仪由欢呼转入受难福音。", 
                liturgy: "祝圣圣枝、圣枝游行、长篇受难史宣读。", act: "带回圣枝放在家中十字架旁。反思：我是否在口头欢呼主，在行动中却抛弃主？" 
            },
            { 
                day: "圣周一至三", title: "心灵静默准备期", focus: "心灵大扫除的最后时机。默想救主如何被推向加尔瓦略山。", 
                liturgy: "早晨弥撒，堂区安排全天候告解。", act: "务必在此期间完成圣事性的告解。保持生活环境极简与肃静。" 
            },
            { 
                day: "圣周四 (4/2)", title: "逾越节三日庆典 (开始)", focus: "‘建立圣体’与‘爱德诫命’。主在此夜为门徒洗脚。", 
                liturgy: "濯足礼；圣体迁往临时祭台；剥除祭台装饰，遮盖圣像。", act: "参与朝拜圣体直到深夜（陪伴山园中的主）。" 
            },
            { 
                day: "圣周五 (4/3)", title: "救主受难纪念", focus: "十字架上的伟大赎献。天主为人类而死。", 
                liturgy: "全日不举行弥撒。朝拜十字架及领受预圣圣体。严守大小斋。", act: "下午3点绝对静默。在圣堂亲吻主受难的伤痕，反省我罪。" 
            },
            { 
                day: "圣周六 (4/4)", title: "逾越节守夜礼 (礼仪之母)", focus: "由死亡经过进入生命的时刻。礼仪之母。", 
                liturgy: "祝圣新火、复活宣报、九篇读经、重申洗礼誓愿。", act: "晚上全程参与隆重守夜礼。迎接真光复活，重生为新造的人。" 
            },
            { 
                day: "复活节 (4/5)", title: "耶稣复活大瞻礼", focus: "死亡被废除了！基督得胜了！这是我们信仰的根基。", 
                liturgy: "欢唱阿肋路亚，弥撒充满白金荣光。", act: "庆祝复活！将这份喜乐带给家人。立志从此活出复活者的光明生活。" 
            }
        ];

        const encyclopediaData = [
            { 
                cat: "逾越节奥迹深度介绍", 
                desc: "‘逾越’意为‘经过’。旧约逾越是天主拯救以色列子民。新约中，基督是真正的逾越羔羊，通过四个阶段完成救赎：\n1. 经过自我（圣周四）：空虚自己，建立圣体。\n2. 经过痛苦（圣周五）：走入死亡深渊。\n3. 经过阴府（圣周六）：救拔古圣先贤。\n4. 经过死亡（复活日）：彻底粉碎死亡。\n这也揭示了每个信友必须‘死于旧我’，才能‘活于基督’。" 
            },
            { 
                cat: "大小斋精准规则", 
                desc: "• 小斋：\n - 时间：四旬期内的每一个周五。\n - 要求：不食禽兽肉。鱼、虾、蛋奶不受限制。\n - 适用：年满14岁至终身。\n• 大斋：\n - 时间：圣灰礼仪日、耶稣受难日（圣周五）。\n - 要求：全日仅进一餐饱食。严禁吃零食。饮水药物不限。\n - 适用：年满18岁至60岁。病弱繁重劳务者可豁免，应以爱德补之。" 
            },
            { 
                cat: "四旬期与洗礼更新", 
                desc: "四旬期在初期教会的核心是‘圣洗预备期’。对于已领洗的信友，这40天则是‘洗礼誓愿的重新激活’。我们通过克己、祈祷和爱德，准备在复活夜重新宣誓：‘我拒绝魔鬼，我拒绝罪恶，我信赖天主。’ 这是一个生命重生的恩宠时期。" 
            }
        ];

        // ================= 渲染与交互 =================
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            const footer = document.getElementById('exam-footer');
            const quote = document.getElementById('quote-card');
            
            if(tabId === 'confession') {
                footer.classList.remove('hidden'); 
                if(quote) quote.classList.add('hidden');
            } else {
                footer.classList.add('hidden'); 
                if(quote) quote.classList.remove('hidden');
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if(typeof lucide !== 'undefined') lucide.createIcons();
        }

        function showConfSub(subId) {
            document.querySelectorAll('.conf-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(subId).classList.remove('hidden');
            
            document.querySelectorAll('.conf-sub-btn').forEach(btn => { 
                btn.classList.remove('conf-nav-active'); 
                btn.classList.add('text-indigo-700', 'bg-white'); 
            });
            const activeBtn = document.getElementById('btn-' + subId);
            if(activeBtn) { 
                activeBtn.classList.add('conf-nav-active'); 
                activeBtn.classList.remove('text-indigo-700', 'bg-white'); 
            }
            if(typeof lucide !== 'undefined') lucide.createIcons();
        }

        function getPlanForDate(dateStr) {
            if(dailyFullPlan[dateStr]) return dailyFullPlan[dateStr];
            const isFri = new Date(dateStr).getDay() === 5;
            return { 
                mentor: "在寂静中跟随主，在祈祷中获力量。", 
                p: "阅读并深度默想当日礼仪读经", 
                f: isFri ? "【小斋】今日戒食肉食；禁绝媒体娱乐" : "节制一项感官爱好", 
                a: isFri ? "参与堂区拜苦路" : "今日默默进行一件爱德善功" 
            };
        }

        function initProgressSystem() {
            const start = new Date(config.startDate);
            const today = new Date(); 
            const diffMs = today - start;
            const diffDays = Math.ceil(Math.max(0, diffMs / (1000 * 60 * 60 * 24)));
            const weekIdx = Math.floor((diffDays - 1) / 7);

            document.getElementById('progress-bar').style.width = `${Math.min(100, (diffDays / 46) * 100)}%`;
            document.getElementById('progress-week-text').innerText = diffDays <= 4 ? "圣灰礼仪后" : `四旬期第 ${weekIdx + 1} 周`;
            document.getElementById('progress-text').innerText = `Day ${diffDays} / 46`;
            
            let dateKey = today.toISOString().split('T')[0];
            document.getElementById('today-date-string').innerText = dateKey;

            document.getElementById('milestones-container').innerHTML = config.milestones.map((m, i) => `
                <div class="milestone-dot w-4 h-4 rounded-full border-2 border-violet-500 pointer-events-auto ${diffDays >= m.offset ? 'active-dot' : 'bg-violet-900/40'}"></div>
            `).join('');

            const plan = getPlanForDate(dateKey);
            document.getElementById('dynamic-guidance-text').innerText = plan.mentor;
            
            const cats = [
                { n: '祈祷 (Prayer)', i:'book-open', c:'text-purple-600', t:[plan.p, "晚间省察：寻找主赐的三个恩典"] },
                { n: '斋戒 (Fasting)', i:'coffee', c:'text-indigo-600', t:[plan.f, "言语节制：不抱怨，不说闲话"] },
                { n: '爱德 (Almsgiving)', i:'heart', c:'text-rose-600', t:[plan.a, "耐心宽恕：对难相处的人保持微笑"] }
            ];
            
            document.getElementById('task-categories').innerHTML = cats.map((cat, cIdx) => `
                <div class="space-y-4">
                    <h4 class="text-[11px] font-black uppercase tracking-[0.3em] ${cat.c} flex items-center gap-3">
                        <i data-lucide="${cat.i}" class="w-4 h-4"></i> ${cat.n}
                    </h4>
                    <div class="space-y-3">
                        ${cat.t.map((item, tIdx) => {
                            const taskId = `task_${dateKey}_${cIdx}_${tIdx}`;
                            const isDone = localStorage.getItem(taskId) === 'true';
                            return `
                                <div onclick="toggleTask('${taskId}', this)" class="task-item flex items-start gap-5 p-6 rounded-[2.5rem] border ${isDone ? 'is-checked border-green-300' : 'border-gray-100 bg-gray-50/50'} cursor-pointer hover:bg-white transition-all group">
                                    <div class="check-box w-7 h-7 rounded-[12px] border-2 border-violet-200 mr-1 flex items-center justify-center bg-white shrink-0 mt-0.5 transition-all">
                                        <i data-lucide="check" class="check-svg w-4 h-4 text-white ${isDone ? '' : 'hidden'}"></i>
                                    </div>
                                    <span class="text-[14px] font-bold text-gray-800 leading-relaxed group-hover:text-violet-950">${item}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(id, el) {
            const isDone = el.classList.toggle('is-checked');
            el.querySelector('.check-svg').classList.toggle('hidden');
            if(isDone) localStorage.setItem(id, 'true'); else localStorage.removeItem(id);
        }

        function renderWeeklyList() { 
            document.getElementById('weekly-list').innerHTML = weeklyFullData.map(w => `
                <div class="bg-white p-12 rounded-[4rem] border border-gray-100 shadow-sm relative overflow-hidden group">
                    <div class="absolute -right-10 -top-10 w-32 h-32 bg-violet-50 rounded-full group-hover:scale-150 transition-transform duration-1000"></div>
                    <div class="flex items-center justify-between mb-8 border-b border-gray-50 pb-8">
                        <h4 class="text-3xl font-black text-gray-900 tracking-tighter">${w.theme}</h4>
                        <span class="text-[10px] bg-violet-100 text-violet-700 px-6 py-2.5 rounded-full font-black uppercase tracking-widest">${w.week}</span>
                    </div>
                    <div class="mb-10 p-8 bg-violet-50 rounded-[2.5rem] border border-violet-100 relative">
                        <p class="text-sm text-violet-950 font-bold leading-[2.2] italic font-serif-church">“${w.intro}”</p>
                        <p class="text-[11px] text-violet-400 mt-6 font-black tracking-widest uppercase flex items-center gap-2">
                            <i data-lucide="bookmark" class="w-3.5 h-3.5"></i> 读经: ${w.scripture}
                        </p>
                    </div>
                    <div class="bg-stone-50 p-10 rounded-[3rem] border border-stone-100">
                        <h5 class="text-[10px] font-black text-stone-400 uppercase tracking-widest mb-8 flex items-center gap-3">本周每日方案</h5>
                        <div class="space-y-6">
                            ${w.days.map((d, i) => `
                                <div class="text-[13px] text-gray-700 leading-relaxed flex gap-5 p-4 border-b border-white last:border-0 hover:bg-white/50 transition-colors rounded-2xl">
                                    <span class="font-black text-violet-400 shrink-0 mt-1">D${i+1}</span>
                                    <p class="font-medium text-gray-800">${d}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join(''); 
        }

        function renderStationsList() { 
            document.getElementById('stations-list').innerHTML = stationsDetailed.map(s => `
                <div class="bg-white p-12 rounded-[4rem] border border-gray-100 shadow-sm station-accent group transition-all duration-500">
                    <div class="flex justify-between items-center mb-8">
                        <span class="text-[11px] font-black text-stone-400 uppercase tracking-[0.4em]">${s.title}</span>
                        <div class="w-14 h-14 rounded-[1.2rem] bg-stone-900 text-white flex items-center justify-center text-lg font-black shadow-xl">${s.id}</div>
                    </div>
                    <h4 class="text-3xl font-black text-stone-950 mb-6 tracking-tight">${s.name}</h4>
                    <div class="p-8 bg-stone-50 rounded-[2.5rem] border border-stone-100 mb-8 font-serif-church italic text-stone-800 text-[15px] leading-[2.5] relative">
                        ${s.scripture}
                    </div>
                    <div class="space-y-8">
                        <div class="prose-church">
                            <h5 class="text-[11px] font-black text-stone-300 uppercase tracking-widest mb-3 flex items-center gap-2">神学默想</h5>
                            <p class="text-[14px] text-gray-600 font-medium leading-[2.2]">“${s.med}”</p>
                        </div>
                        <div class="bg-violet-50 p-8 rounded-[2.5rem] border border-violet-100 relative">
                            <strong class="flex items-center gap-3 mb-3 text-[10px] text-violet-700 uppercase tracking-widest font-black">
                                <i data-lucide="target" class="w-4 h-4"></i> 今日定志行动
                            </strong>
                            <p class="text-[15px] text-violet-950 font-bold leading-relaxed">${s.res}</p>
                        </div>
                        <div class="bg-indigo-50/50 p-7 rounded-[2rem] italic text-[12px] text-indigo-700 font-medium leading-loose">
                            <strong>经文祷词：</strong> ${s.prayer}
                        </div>
                    </div>
                </div>
            `).join(''); 
        }

        function renderHolyWeekPlan() { 
            document.getElementById('holyweek-list').innerHTML = holyWeekPlan.map(h => `
                <div class="bg-white p-12 rounded-[4rem] border-l-[12px] border-l-red-900 shadow-sm space-y-8 relative overflow-hidden group">
                    <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:scale-150 transition-all duration-1000"><i data-lucide="flame" class="w-32 h-32"></i></div>
                    <div class="flex flex-col gap-3">
                        <span class="text-[10px] font-black text-red-700 uppercase tracking-[0.4em] border-2 border-red-100 px-5 py-2 rounded-full w-fit bg-red-50/30">${h.day}</span>
                        <h3 class="text-3xl font-black text-red-950 tracking-tighter">${h.title}</h3>
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        <div class="p-8 bg-gray-50 rounded-[2.5rem] border border-gray-100">
                            <h5 class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3">救赎焦点 / Mystery</h5>
                            <p class="text-[14px] text-gray-700 font-medium leading-[2.2]">${h.focus}</p>
                        </div>
                        <div class="p-8 bg-red-50/50 rounded-[2.5rem] border border-red-100">
                            <h5 class="text-[10px] font-black text-red-800 uppercase tracking-widest mb-3">礼仪环节 / Liturgy</h5>
                            <p class="text-[14px] text-red-900 font-bold leading-[2.2]">${h.liturgy}</p>
                        </div>
                    </div>
                    <div class="bg-red-900 p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden group">
                        <div class="absolute inset-0 bg-red-800 translate-y-full group-hover:translate-y-0 transition-transform duration-700"></div>
                        <p class="text-[15px] font-bold leading-loose flex items-start gap-4 italic font-serif-church relative z-10">
                            <i data-lucide="heart" class="w-6 h-6 fill-white text-red-900 mt-1 shrink-0"></i>
                            “${h.act}”
                        </p>
                    </div>
                </div>
            `).join(''); 
        }

        function renderEncyclopedia() { 
            document.getElementById('liturgy-info-list').innerHTML = encyclopediaData.map(i => `
                <div class="bg-white p-12 rounded-[4rem] shadow-sm border border-amber-50 group hover:border-amber-300 transition-all duration-500">
                    <h4 class="text-amber-950 font-black text-3xl mb-8 flex items-center gap-6">
                        <span class="w-16 h-16 bg-amber-100 text-amber-700 rounded-3xl flex items-center justify-center shadow-inner group-hover:rotate-12 transition-transform duration-700">
                            <i data-lucide="book-open" class="w-8 h-8"></i>
                        </span>
                        ${i.cat}
                    </h4>
                    <p class="text-[15px] text-gray-600 leading-[2.5] whitespace-pre-line font-medium prose-church">${i.desc}</p>
                </div>
            `).join(''); 
        }
        
        // 全新：深度渲染嵌套结构的告解数据
        function renderConfData() {
            // 渲染全备省察清单 (三级嵌套)
            document.getElementById('exam-list-container').innerHTML = confessionContentData.examGroups.map(group => `
                <div class="space-y-10">
                    <div class="bg-indigo-50 border border-indigo-100 p-8 rounded-[3rem]">
                        <h3 class="font-black text-indigo-950 text-2xl flex items-center gap-3">
                            <i data-lucide="book-open" class="w-6 h-6 text-indigo-600"></i> ${group.groupTitle}
                        </h3>
                        <p class="text-[13px] text-indigo-800 mt-3 font-medium leading-relaxed">${group.groupDesc}</p>
                    </div>
                    <div class="space-y-10">
                        ${group.sections.map(sec => `
                            <div class="space-y-4">
                                <h4 class="font-bold text-indigo-900 text-lg flex items-center gap-3 border-b border-indigo-100 pb-3">
                                    <span class="w-2.5 h-2.5 rounded-full bg-indigo-500"></span>
                                    ${sec.subtitle}
                                </h4>
                                <div class="grid grid-cols-1 gap-3">
                                    ${sec.items.map(q => {
                                        const isDone = localStorage.getItem('conf_'+q.id) === 'true';
                                        return `
                                            <div onclick="toggleExamCheck(this, '${q.id}')" data-text="${q.q}" class="exam-item flex items-start gap-4 p-5 rounded-[2.5rem] border ${isDone ? 'is-checked border-indigo-300' : 'border-gray-100 bg-white'} hover:bg-indigo-50/60 cursor-pointer transition-all shadow-sm">
                                                <div class="exam-check-box w-7 h-7 rounded-[10px] border-2 border-indigo-200 flex-shrink-0 mt-0.5 flex items-center justify-center bg-white transition-all">
                                                    <i data-lucide="check" class="exam-check-svg w-4 h-4 text-white ${isDone ? '' : 'hidden'}"></i>
                                                </div>
                                                <p class="text-[14px] text-gray-700 leading-[1.8] font-medium transition-colors">${q.q}</p>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('<div class="h-px bg-slate-200 my-16"></div>');

            // 渲染 6 步实战流程
            document.getElementById('confession-script').innerHTML = confessionContentData.steps.map((s, i) => `
                <div class="relative pl-14 border-l-4 border-dashed border-indigo-100 pb-10 last:pb-0">
                    <div class="absolute -left-[20px] top-0 w-9 h-9 rounded-xl bg-indigo-600 text-white flex items-center justify-center text-base font-black border-4 border-[#f8f7fc] shadow-md">${i+1}</div>
                    <h5 class="font-black text-indigo-950 text-xl mb-3 tracking-tight">${s.t}</h5>
                    <div class="bg-gray-50/80 p-6 rounded-[2rem] text-[14px] text-gray-600 font-medium leading-[2.2] border border-gray-100">${s.d}</div>
                </div>
            `).join('');

            // 渲染常用经文
            document.getElementById('prayers-container').innerHTML = `
                <div class="space-y-12">
                    <div>
                        <h4 class="text-2xl font-black text-indigo-950 flex items-center gap-4 mb-6">
                            <span class="w-2.5 h-10 bg-indigo-600 rounded-full"></span> 痛悔经 (传统文言版)
                        </h4>
                        <div class="bg-indigo-50/60 p-10 rounded-[3rem] border border-indigo-100 relative shadow-inner">
                            <p class="text-[16px] leading-[2.5] text-slate-700 font-serif-church font-medium mb-4 relative z-10">吾主耶稣，基利斯督，造我养我，救我之主。我重罪人，得罪天主。今特为爱天主在万有之上，专心痛悔，恼恨我罪，决意定改，宁死再不敢得罪天主。望主看你圣苦难之功，可怜我等。阿们。</p>
                            <span class="text-indigo-400 text-[11px] font-bold uppercase tracking-widest relative z-10">—— 许多老教友使用的传统版本</span>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-2xl font-black text-indigo-500 flex items-center gap-4 mb-6">
                            <span class="w-2.5 h-10 bg-indigo-400 rounded-full"></span> 痛悔经 (现代白话版)
                        </h4>
                        <div class="bg-slate-50 p-10 rounded-[3rem] border border-slate-100 relative shadow-inner">
                            <p class="text-[16px] leading-[2.5] text-slate-700 font-medium mb-4 relative z-10">主，耶稣基督，你是除免世罪的天主羔羊。求你藉着圣神的恩宠，恢复我与圣父间的关系；并在你的血内，洗净我的一切罪污；并为你的光荣，使我重新生活。阿们。</p>
                            <span class="text-slate-400 text-[11px] font-bold uppercase tracking-widest relative z-10">—— 较通俗易懂的现代版本</span>
                        </div>
                    </div>

                    <div class="bg-amber-50 rounded-[2.5rem] p-8 text-amber-800 border border-amber-100 flex gap-5 items-start shadow-sm mt-8">
                        <i data-lucide="info" class="w-8 h-8 shrink-0 text-amber-500"></i>
                        <div>
                            <h5 class="font-black text-[15px] mb-2">温馨提示</h5>
                            <p class="text-[13px] leading-[2] font-medium">如果您背不出《痛悔经》，可以直接对神父说：“神父，我虽然背不出经文，但我真心后悔得罪了天主，求主宽恕。” 或者直接用自己的话表达悔意。</p>
                        </div>
                    </div>
                </div>
            `;
            updateExamBadge();
        }

        // 告解交互逻辑 (利用 data-text 避免由于标点符号引起的转义报错)
        function toggleExamCheck(el, id) {
            const isChecked = el.classList.toggle('is-checked');
            el.querySelector('.exam-check-svg').classList.toggle('hidden');
            const text = el.getAttribute('data-text');
            if (isChecked) { 
                localStorage.setItem('conf_'+id, 'true'); 
                localStorage.setItem('conf_text_'+id, text); 
            } else { 
                localStorage.removeItem('conf_'+id); 
                localStorage.removeItem('conf_text_'+id); 
            }
            updateExamBadge();
        }
        
        function updateExamBadge() { 
            document.getElementById('exam-badge').innerText = document.querySelectorAll('.exam-item.is-checked').length; 
        }
        
        function copyConfessionList() {
            let listText = "【告解备忘录】\n", hasItems = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('conf_text_')) { 
                    listText += "• " + localStorage.getItem(key) + "\n"; 
                    hasItems = true; 
                }
            }
            if (!hasItems) return alert("您还没有勾选任何条目。");
            navigator.clipboard.writeText(listText).then(() => alert("已复制！排队办告解时可粘贴到备忘录中查看。"));
        }
        
        function resetExam() {
            if(confirm("确定要清空全部勾选记录吗？")) {
                let keys = [];
                for(let i=0; i<localStorage.length; i++) { 
                    if(localStorage.key(i).startsWith('conf_') || localStorage.key(i).startsWith('task_')) 
                        keys.push(localStorage.key(i)); 
                }
                keys.forEach(k => localStorage.removeItem(k));
                location.reload(); // 刷新以重置所有 UI 状态
            }
        }

        // ================= 初始化 =================
        window.onload = () => {
            try {
                initProgressSystem();
                renderWeeklyList();
                renderStationsList();
                renderConfData();
                renderHolyWeekPlan();
                renderEncyclopedia();

                if(typeof lucide !== 'undefined') lucide.createIcons();
                
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);

                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js').catch(() => console.log('SW 注册受限'));
                }
            } catch (error) {
                document.getElementById('loading-screen').style.display = 'none';
                throw error;
            }
        };
    </script>
</body>
</html>
