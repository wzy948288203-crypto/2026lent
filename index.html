<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 善度四旬期与告解圣事深度全指南</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6d28d9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="四旬期指南">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js" defer></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Noto+Serif+SC:wght@400;700;900&display=swap');
        :root { --church-violet: #6d28d9; --church-indigo: #4338ca; --church-emerald: #10b981; }
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f8f7fc; color: #111827; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        .font-serif-church { font-family: 'Noto Serif SC', serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .milestone-dot { transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; background-color: rgba(139, 92, 246, 0.4); }
        .active-dot { background-color: white !important; box-shadow: 0 0 10px rgba(255,255,255,0.8); transform: scale(1.35); }
        .task-item.is-checked { background-color: #f0fdf4 !important; border-color: #86efac !important; }
        .task-item.is-checked .check-box { background-color: #22c55e !important; border-color: #22c55e !important; }
        .task-item.is-checked .check-svg { display: block !important; }
        .exam-item.is-checked { background-color: #eef2ff !important; border-color: #a5b4fc !important; }
        .exam-item.is-checked .exam-check-box { background-color: #4f46e5 !important; border-color: #4f46e5 !important; }
        .exam-item.is-checked .exam-check-svg { display: block !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .shadow-premium { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .station-accent { border-left: 4px solid #4b5563; }
        .station-accent:hover { border-left-color: #7c3aed; }
        .conf-nav-active { background-color: #4f46e5 !important; color: white !important; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); }
        .prose-church { line-height: 2; letter-spacing: 0.01em; }
    </style>
</head>
<body class="pb-40">
    <div id="loading-screen" class="fixed inset-0 bg-[#f8f7fc] z-[999] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-10 h-10 border-4 border-violet-200 border-t-violet-700 rounded-full animate-spin mb-4"></div>
        <p class="text-violet-900 font-bold text-xs">正在加载堂区灵修资源...</p>
    </div>

    <header class="bg-white/95 backdrop-blur-xl border-b sticky top-0 z-[100] pt-[env(safe-area-inset-top)]">
        <div class="max-w-2xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="showTab('home')">
                <div class="bg-violet-700 p-2 rounded-[14px] text-white shadow-md">
                    <i data-lucide="cross" class="w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="text-[16px] font-black text-violet-950 leading-none tracking-tight">2026 善度四旬期</h1>
                    <span class="text-[9px] text-violet-500 uppercase tracking-widest font-bold mt-1 block">深度灵修与告解指南</span>
                </div>
            </div>
            <button onclick="showTab('liturgy')" class="text-[11px] font-black px-4 py-2 rounded-full text-violet-700 bg-violet-50 border border-violet-100 flex items-center gap-1.5">
                <i data-lucide="info" class="w-3.5 h-3.5"></i> 百科
            </button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 py-6">
        
        <div id="home" class="tab-content active space-y-6">
            <div class="bg-gradient-to-br from-violet-800 via-violet-950 to-indigo-950 rounded-[2rem] p-6 text-white shadow-xl relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 w-32 h-32 bg-white/5 rounded-full blur-2xl"></div>
                <div class="flex justify-between items-center mb-8">
                    <div class="flex items-center gap-2.5">
                        <div class="bg-white/10 p-2 rounded-xl backdrop-blur-md"><i data-lucide="compass" class="w-4 h-4 text-violet-200"></i></div>
                        <span id="progress-week-text" class="font-black text-sm tracking-wide">载入进度...</span>
                    </div>
                    <span id="progress-text" class="bg-white/20 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">Day 0 / 46</span>
                </div>
                <div class="relative px-1 mb-12">
                    <div class="w-full bg-white/10 rounded-full h-2.5 overflow-hidden shadow-inner">
                        <div id="progress-bar" class="bg-white h-full rounded-full transition-all duration-1000 shadow-[0_0_15px_rgba(255,255,255,0.6)]" style="width: 0%"></div>
                    </div>
                    <div id="milestones-container" class="absolute top-1/2 -translate-y-1/2 w-full left-0 px-0 flex justify-between pointer-events-none"></div>
                    <div class="absolute w-full flex justify-between mt-5 px-0 text-[7px] font-black opacity-90 leading-tight">
                        <div class="flex flex-col items-center w-10 -ml-3 text-center"><span>圣灰</span><span class="opacity-50 mt-0.5">2/18</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第一</span><span class="opacity-50 mt-0.5">2/22</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第二</span><span class="opacity-50 mt-0.5">3/01</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第三</span><span class="opacity-50 mt-0.5">3/08</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第四</span><span class="opacity-50 mt-0.5">3/15</span></div>
                        <div class="flex flex-col items-center w-10 text-center text-amber-300"><span>第五</span><span class="opacity-50 mt-0.5">3/22</span></div>
                        <div class="flex flex-col items-center w-10 text-red-300"><span>圣枝</span><span class="opacity-50 mt-0.5">3/29</span></div>
                        <div class="flex flex-col items-center w-10 -mr-3 text-yellow-300 text-center"><span>复活</span><span class="opacity-50 mt-0.5">4/05</span></div>
                    </div>
                </div>
                <div class="flex justify-between items-end text-[10px] opacity-70 border-t border-white/10 pt-3">
                    <div><span class="font-bold">2026 四旬期旅程</span></div>
                    <div class="text-right"><span id="today-date-string" class="text-xs font-black tracking-tighter block">载入中...</span></div>
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 text-center shadow-sm">
                <p class="text-[10px] text-gray-500 font-bold flex items-center justify-center gap-1.5">
                    <i data-lucide="shield-check" class="w-3.5 h-3.5 text-emerald-500"></i>
                    纯静态网页，您的打卡记录与告解清单仅保存在本机，请放心使用。
                </p>
            </div>

            <div class="bg-amber-50 border border-amber-200 rounded-[1.5rem] p-5 flex gap-4 items-center shadow-sm relative overflow-hidden">
                <div class="w-12 h-12 bg-amber-100 text-amber-700 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-inner"><i data-lucide="bell" class="w-6 h-6 animate-bounce"></i></div>
                <div class="flex-1">
                    <h4 class="text-[13px] font-black text-amber-950 mb-1">深圳圣安多尼堂通知</h4>
                    <p class="text-[11px] text-amber-800 leading-relaxed font-bold">四旬期内每周五 <span class="bg-amber-200/50 px-1.5 py-0.5 rounded text-amber-900">15:00</span> 举行拜苦路与弥撒。</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="showTab('weekly')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-violet-50 text-violet-600 flex items-center justify-center mb-3"><i data-lucide="layers" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">每周重点</span>
                </button>
                <button onclick="showTab('stations')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-stone-50 text-stone-700 flex items-center justify-center mb-3"><i data-lucide="milestone" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">拜苦路</span>
                </button>
                <button onclick="showTab('confession')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-indigo-50 text-indigo-700 flex items-center justify-center mb-3"><i data-lucide="heart-handshake" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">告解圣事</span>
                </button>
                <button onclick="showTab('holyweek')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-red-50 text-red-600 flex items-center justify-center mb-3"><i data-lucide="flame" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">圣周指南</span>
                </button>
            </div>

            <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-black text-gray-900 tracking-tight">今日修德方案</h3>
                        <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mt-0.5">Spiritual Training</p>
                    </div>
                    <div class="bg-violet-100 text-violet-700 p-2.5 rounded-[14px]"><i data-lucide="sparkles" class="w-5 h-5"></i></div>
                </div>
                
                <div class="bg-violet-50 p-5 rounded-3xl mb-8 border border-violet-100/50 relative overflow-hidden">
                    <div class="absolute -right-2 -top-2 opacity-5"><i data-lucide="quote" class="w-16 h-16 text-violet-900"></i></div>
                    <h5 class="text-[10px] font-black text-violet-400 uppercase tracking-widest mb-2 flex items-center gap-1.5"><i data-lucide="message-circle" class="w-3 h-3"></i> 灵修指引</h5>
                    <p id="dynamic-guidance-text" class="text-[14px] text-violet-950 font-bold leading-relaxed italic font-serif-church relative z-10">载入中...</p>
                </div>
                <div id="task-categories" class="space-y-8"></div>
            </div>
            
            <footer class="pt-6 pb-2 text-center opacity-60">
                <p class="text-[9px] font-black tracking-widest uppercase mb-1">Produced By SAC</p>
                <p class="text-[10px] font-bold">划向深处小组制作</p>
            </footer>
        </div>

        <div id="weekly" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-violet-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-violet-950 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 rotate-12"><i data-lucide="scroll-text" class="w-32 h-32"></i></div>
                <h2 class="text-2xl font-black mb-4 tracking-tighter relative z-10">每周灵修大纲</h2>
                <p class="text-violet-200 leading-[1.8] text-[13px] font-medium prose-church relative z-10">四旬期是一场灵魂由世俗之“奴役”走向天主之“自由”的伟大法行。每周的主日福音都是这一段航程的灯塔。</p>
            </div>
            <div id="weekly-list" class="space-y-8"></div>
        </div>

        <div id="stations" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-stone-700 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-stone-900 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute -right-4 -bottom-4 opacity-10"><i data-lucide="cross" class="w-40 h-40"></i></div>
                <h2 class="text-2xl font-black mb-4 tracking-tighter relative z-10">拜苦路深度默想</h2>
                <p class="text-stone-300 text-[13px] leading-[1.8] italic font-serif-church relative z-10">“谁若愿意跟随我，该弃绝自己，天天背起自己的十字架跟随我。” (路9:23)</p>
            </div>
            <div id="stations-list" class="space-y-8"></div>
        </div>

        <div id="confession" class="tab-content space-y-6 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-indigo-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            
            <div class="bg-white p-1.5 rounded-[1.5rem] shadow-sm border border-indigo-50 flex items-center gap-1 sticky top-[4.5rem] z-50 overflow-x-auto no-scrollbar">
                <button onclick="showConfSub('conf-intro')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all conf-nav-active" id="btn-conf-intro">意义</button>
                <button onclick="showConfSub('conf-prep')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-prep">准备</button>
                <button onclick="showConfSub('conf-exam')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-exam">省察清单</button>
                <button onclick="showConfSub('conf-step')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-step">流程</button>
                <button onclick="showConfSub('conf-prayer')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-prayer">经文</button>
            </div>

            <div id="conf-intro" class="conf-section space-y-6">
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-indigo-50 leading-[2] text-[13px] prose-church text-gray-700">
                    <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mb-6"><i data-lucide="sparkles" class="w-6 h-6"></i></div>
                    <h3 class="text-xl font-black text-indigo-950 mb-4">重拾和好的喜乐</h3>
                    <p class="mb-6 font-bold text-gray-900">告解圣事是天主慈悲的具体体现。耶稣不仅赦免罪过，更治愈受伤的心灵。</p>
                    <ul class="space-y-3">
                        <li class="flex gap-3 p-4 bg-indigo-50/50 rounded-2xl border border-indigo-50"><i data-lucide="check-circle" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i><span><b>洗净罪污：</b> 彻底宽赦罪过，重新焕发光辉。</span></li>
                        <li class="flex gap-3 p-4 bg-indigo-50/50 rounded-2xl border border-indigo-50"><i data-lucide="check-circle" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i><span><b>确切平安：</b> 亲耳听到‘我赦免你的罪’。</span></li>
                    </ul>
                </div>
            </div>
            
            <div id="conf-prep" class="conf-section hidden space-y-6">
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-indigo-100">
                    <h3 class="text-xl font-black text-indigo-950 mb-5 flex items-center gap-2"><i data-lucide="hourglass" class="w-5 h-5 text-indigo-500"></i> 告解前的预备</h3>
                    <div class="space-y-4 text-[13px] text-gray-600 prose-church">
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">1. 静下心来</h4><p>寻找安静角落，面对仁慈的父亲。</p></div>
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">2. 祈求光照</h4><p>祈求圣神照亮记忆，赐予痛悔力量。</p></div>
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">3. 诚实面对</h4><p>不要找借口，坦诚说：‘我做了这件事，我很后悔。’</p></div>
                        <div class="bg-indigo-600 p-6 rounded-2xl text-white mt-2">
                            <h5 class="font-black text-[10px] uppercase tracking-widest mb-2 opacity-70">准备祷词</h5>
                            <p class="text-[14px] italic font-serif-church font-bold leading-relaxed">“我主、我神！我承认我多次犯罪...求祢宽恕我的罪，并赐我改过的决心。阿们。”</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="conf-exam" class="conf-section hidden space-y-8">
                <div class="bg-indigo-950 text-white p-8 rounded-[2rem] shadow-md relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-10 rotate-12"><i data-lucide="clipboard-list" class="w-32 h-32"></i></div>
                    <h3 class="text-xl font-black mb-2 relative z-10 flex items-center gap-2"><i data-lucide="search" class="w-5 h-5 text-indigo-400"></i> 详细省察清单</h3>
                    <p class="text-[11px] text-indigo-200 leading-[1.8] relative z-10">点击各项记录到待告明清单（仅存本机）。主已知道一切，祂只想听见您的诚实。</p>
                </div>
                <div id="exam-list-container" class="space-y-10"></div>
            </div>

            <div id="conf-step" class="conf-section hidden space-y-6">
                <div id="confession-script" class="bg-white p-6 rounded-[2rem] border border-indigo-50 space-y-8"></div>
            </div>

            <div id="conf-prayer" class="conf-section hidden space-y-6">
                <div class="bg-white p-8 rounded-[2rem] border border-indigo-100 shadow-sm space-y-8" id="prayers-container"></div>
            </div>
        </div>

        <div id="holyweek" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-red-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-red-950 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-red-500 opacity-20 rounded-full blur-[40px]"></div>
                <h2 class="text-2xl font-black mb-3 tracking-tighter relative z-10">圣周深度指南</h2>
                <p class="text-red-200 leading-[1.8] text-[13px] font-medium prose-church relative z-10">逾越节三日庆典是救恩史巅峰。跟随基督由山园忧闷走上加尔瓦略山。</p>
            </div>
            <div id="holyweek-list" class="space-y-8"></div>
        </div>

        <div id="liturgy" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-amber-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-amber-100 p-8 rounded-[2rem] border border-amber-200 shadow-inner">
                <h2 class="text-2xl font-black text-amber-950 mb-2 tracking-tighter">四旬期深度百科</h2>
                <p class="text-amber-900/70 text-[12px] font-bold italic font-serif-church">探索 40 天旷野旅程的神学奥秘。</p>
            </div>
            <div id="liturgy-info-list" class="space-y-8"></div>
        </div>
    </main>

    <div id="exam-footer" class="fixed bottom-24 left-1/2 -translate-x-1/2 w-full max-w-sm px-4 hidden z-[110] transition-transform duration-500">
        <div class="bg-indigo-950 text-white p-3.5 rounded-full shadow-2xl flex justify-between items-center border border-indigo-700 ring-4 ring-indigo-900/40">
            <div class="flex items-center gap-3 pl-2">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center font-black text-lg shadow-inner" id="exam-badge">0</div>
                <span class="text-[10px] font-black uppercase text-indigo-300 tracking-[0.1em] leading-tight">已记下罪项</span>
            </div>
            <div class="flex gap-2 pr-1">
                <button onclick="copyConfessionList()" class="text-[10px] bg-indigo-500/20 px-4 py-2.5 rounded-full font-black hover:bg-indigo-500/40 border border-indigo-400/30 flex items-center gap-1"><i data-lucide="copy" class="w-3.5 h-3.5"></i> 复制</button>
                <button onclick="resetExam()" class="text-[10px] bg-red-500/20 px-4 py-2.5 rounded-full font-black hover:bg-red-500/40 border border-red-400/30 flex items-center gap-1"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i> 清空</button>
            </div>
        </div>
    </div>

    <div id="quote-card" class="fixed bottom-6 md:bottom-8 left-1/2 -translate-x-1/2 w-full max-w-md px-4 pointer-events-none transition-opacity duration-700 z-[120]">
        <div class="bg-white/95 backdrop-blur-xl shadow-lg border border-violet-100/50 p-4 rounded-[1.5rem] flex items-center gap-4 pointer-events-auto border-t-4 border-t-violet-600">
            <div class="bg-violet-600 p-2.5 rounded-xl text-white shadow-md flex-shrink-0">
                <i data-lucide="sparkles" class="w-4 h-4 animate-pulse"></i>
            </div>
            <p id="daily-quote" class="text-[12px] font-black text-violet-950 leading-relaxed italic font-serif-church">“你们应回头改过，信从福音。”</p>
        </div>
    </div>

    <div id="error-output" class="hidden fixed inset-0 bg-white z-[9999] p-8 overflow-auto text-red-600 font-mono text-sm"></div>

    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const ls = document.getElementById('loading-screen');
            if(ls) ls.style.display = 'none';
            const errDiv = document.getElementById('error-output');
            if(errDiv) {
                errDiv.classList.remove('hidden');
                errDiv.innerHTML += `<p>Error: ${msg} <br>Line: ${lineNo}</p>`;
            }
            return false;
        };

        const quotes = [
            "“记住：你原来是尘土，将来仍要归于尘土。”",
            "“斋戒不只是空肚子，更是为了腾出空间给天主。”",
            "“施舍不是给予我们多余的，而是分享我们必需的。”",
            "“祈祷是让天主的手去塑造我们的灵魂。”",
            "“在这个四旬期，让我们多一点仁慈，少一点评判。”",
            "“旷野不是惩罚，而是聆听天主微弱声音的圣殿。”",
            "“最大的禁食，是戒绝心中的骄傲与贪婪。”",
            "“基督的受难是爱的极致，我们的悔改是对爱的响应。”"
        ];

        const config = { startDate: '2026-02-18', milestones: [{ offset: 0, title: '圣灰礼仪', date: '2/18' }, { offset: 4, title: '第一主日', date: '2/22' }, { offset: 11, title: '第二主日', date: '3/1' }, { offset: 18, title: '第三主日', date: '3/8' }, { offset: 25, title: '第四主日', date: '3/15' }, { offset: 32, title: '第五主日', date: '3/22' }, { offset: 39, title: '圣枝主日', date: '3/29' }, { offset: 46, title: '复活主日', date: '4/5' }] };

        const dailyFullPlan = {
            "2026-02-18": { mentor: "【圣灰礼仪】灰烬的记号提醒我们生命的脆弱，也预示复活的新生。今日请深度默想这一场由尘土走向永恒的逾越。", p: "参与圣灰礼仪弥撒；阅读并默想玛窦福音 6:1-6；晚间安静省察15分钟", f: "全守大斋小斋：全日进一饱餐；禁食肉类及零食", a: "在圣堂慈善箱悄悄放入一笔款项" },
            "2026-02-19": { mentor: "【旷野初探】耶稣被领入旷野。今日请刻意寻找一个物理上的‘安静角落’，听听被世俗掩盖的灵魂渴求。", p: "寻找苦像前练习15分钟绝对静默；慢诵天主经5遍", f: "戒绝今日所有的甜味饮品，回归白水的简单", a: "对今天遇到的劳动者致以诚挚的感谢" },
            "2026-02-20": { mentor: "【苦难周五】下午三点是主受难时刻。请暂时放下手中的繁忙，陪伴为我舍命的救主。", p: "15:00 参与圣安多尼堂拜苦路与弥撒", f: "守小斋：禁肉食；斋戒电子媒体感官娱乐", a: "为一位你曾有过嫌隙的邻人默默代祷" },
            "2026-02-21": { mentor: "【省察日】主不嫌弃罪人。今日请对照指南，为您的灵魂举行一次大扫除。", p: "进行深度省察，准备办告解；读圣咏第51篇", f: "今日不食用甜点，磨练意志", a: "整理家中闲置物品，计划捐赠" },
            "2026-02-22": { mentor: "【第一主日】主受试探。耶稣用圣言反击。反思：什么是我目前最大的试探？", p: "参与主日弥撒；深度默想玛窦福音 4:1-11", f: "主日不强制禁食，但在网络社交上保持节制", a: "全心陪伴家人，关闭手机通知" },
            "2026-02-23": { mentor: "【修德日：谦卑】即便你完成了一项伟大的工作，也要在心中说：‘我是无用的仆人’。", p: "诵念圣母七苦经；默想圣母的低微", f: "言语斋戒：今日不发表‘评价他人’的言论", a: "秘密为他人完成一件繁琐的小事" }
        };

        const weeklyFullData = [
            { week: "第一周", theme: "旷野与诱惑", focus: "分辨诱惑，操练自制。", scripture: "玛 4:1-11", intro: "跟随耶稣进入旷野。我们要学习用圣言来抵挡‘肉欲、虚荣与权力’这三大诱惑。", days: ["主日：【福音】耶稣在旷野。焦点：识别我生命中的‘假神’。","周一：【灵修指引】练习‘识别虚荣’。想炫耀时选择神圣的沉默。","周二：【灵修指引】练习‘物欲节制’。拒绝购买非必需品。","周三：【灵修指引】练习‘诚实’。在琐事上绝不说谎。","周四：【灵修指引】练习‘代祷’。为深陷网瘾者代祷。","周五：【受难】参与拜苦路，感受十字架真实的沉重。","周六：【谦卑】练习‘无名善行’。做好事绝不让对方知道。"] },
            { week: "第二周", theme: "显容与光荣", focus: "在苦难阴影中仰望真光。", scripture: "玛 17:1-9", intro: "显容是为了告诉门徒：苦难不是终点。我们要练习在琐碎暗淡的生活里，认出基督的荣光。", days: ["主日：【福音】山上显容。在平凡家务中认出主荣光。","周一：【灵修指引】信心操练：遇到沮丧复述‘主我相信祢’。","周二：【灵修指引】心境整理：摒弃焦虑，交还给天主。","周三：【灵修指引】分享真光：探望灰心丧志的教友。","周四：【灵修指引】听命练习：顺服一个你不喜欢的建议。","周五：【受难】参与拜苦路。荣光的背后是荆棘。","周六：【渴望】深度自省：我对新生命的渴望真切吗？"] }
        ];

        const stationsDetailed = [
            { id: 1, title: "第一处", name: "耶稣判死刑", scripture: "“彼拉多把耶稣交出来钉在十字架上。” (玛27:26)", med: "在不义审判前祢保持静默。求祢治愈我爱面子胜过爱真理的心。", prayer: "主耶稣，赐我勇气不顾世俗评判为祢作证。阿们。", res: "今日绝不说任何违背良知的辩解之词。" },
            { id: 2, title: "第二处", name: "耶稣背苦架", scripture: "“耶稣自己背着十字架出来...” (若19:17)", med: "祢没有抱怨。请教导我带着爱去接纳无法改变的人生重担。", prayer: "主耶稣，赐我接纳的恩宠，在琐碎中看见希望。阿们。", res: "今日不抱怨遇到的任何繁琐工作或突发事件。" },
            { id: 3, title: "第三处", name: "耶稣一跌倒", scripture: "“祂实在承担了我们的疾苦。” (依53:4)", med: "跌倒不可怕，可怕的是沉溺绝望。当我反复跌倒时，求祢拉我一把。", prayer: "主耶稣，在我软弱时做我支柱，赐我重新站起的坚韧。阿们。", res: "针对一个最常犯的小毛病，进行三次主动克制。" },
            { id: 4, title: "第四处", name: "耶稣遇圣母", scripture: "“有一把利剑要刺透你的心灵。” (路2:35)", med: "圣母陪伴主走苦路。圣母，请在我的苦路上也陪伴着我。", prayer: "至圣童贞玛利亚，在我灰心时领我走向耶稣。阿们。", res: "今日主动致电探望父母长辈，并为已故教友祈祷。" },
            { id: 5, title: "第五处", name: "西满助耶稣", scripture: "“他们叫西满背起十字架，跟在耶稣后面。” (路23:26)", med: "我愿意在小事上分担近人的负担吗？哪怕只是微不足道的杂活。", prayer: "主耶稣，除去我的自私，让我在别人需要时挺身而出。阿们。", res: "今日额外帮家人或同事分担一项本不属于我的琐事。" },
            { id: 6, title: "第六处", name: "圣妇拭圣面", scripture: "“主，我要寻求祢的面。” (咏27:8)", med: "面对社会的冷漠，我的一点温柔也有永恒价值。我愿成为这方手帕吗？", prayer: "主耶稣，将祢的圣容印在我的灵魂里。阿们。", res: "今日对每一位为你提供服务的人露出最诚挚的微笑。" },
            { id: 7, title: "第七处", name: "耶稣二跌倒", scripture: "“凡是自卑的，必被提升。” (路14:11)", med: "圣德是无数次失败后的坚持。主，当我因枯燥想放弃时，赐我恒心。", prayer: "主耶稣，赐我坚持的恒心，不在修行路上半途而废。阿们。", res: "不论今日多忙碌，都要高质量完成定下的读经计划。" },
            { id: 8, title: "第八处", name: "耶稣劝妇女", scripture: "“不要为我哭，应为你们和你们的孩子哭。” (路23:28)", med: "我是否太关注自己的痛，而忽视了他人？教导我为世界之罪悔恨。", prayer: "主耶稣，扩大我的心胸，为罪人献上代祷。阿们。", res: "今日戒掉一项娱乐，专用于为世界和平代祷。" },
            { id: 9, title: "第九处", name: "耶稣三跌倒", scripture: "“我的能力在软弱中才全显出来。” (格后12:9)", med: "主是绝望者最后的唯一依恃。求主赐我在绝处依然信靠主恩。", prayer: "主耶稣，在人生的尽头做我的支柱。阿们。", res: "在今日最疲惫想发怒的瞬间，先默念：‘主，救我。’" },
            { id: 10, title: "第十处", name: "耶稣被剥衣", scripture: "“他们分了我的衣服...” (咏22:19)", med: "剥去外物，显露赤诚。求主剥去我爱面子的虚伪及对物质的贪恋。", prayer: "主耶稣，剥去我的虚假，让我诚实承认罪过。阿们。", res: "今日清理掉一件因贪欲而占有的多余物品。" },
            { id: 11, title: "第十一处", name: "耶稣钉架上", scripture: "“父啊，宽赦他们吧...” (路23:34)", med: "主在剧痛中选择了宽恕。请主今日拔除我心中不愿原谅的钉子。", prayer: "主耶稣，治愈我仇恨的伤疤，赐我原谅他人的力量。阿们。", res: "在心中诚挚地对曾伤害过我的人说：‘我选择宽恕你。’" },
            { id: 12, title: "第十二处", name: "耶稣死架上", scripture: "“父啊！我把我的灵魂交托在祢手中。” (路23:46)", med: "天主为我而死。还有什么计较放不下呢？愿祢的死成为我苏醒起点。", prayer: "主耶稣，愿祢的死亡成为我的新生。阿们。", res: "今日下午3点，面向苦像保持3分钟绝对静默。" },
            { id: 13, title: "第十三处", name: "耶稣下苦架", scripture: "“若瑟领下了耶稣的遗体。” (路23:50-53)", med: "求主使我在丧恸时能靠在圣母怀里，学会在寂静中托付主旨。", prayer: "圣母玛利亚，在人生的终点领我回到耶稣怀抱。阿们。", res: "诵念经文，专门为一生中已去世的恩人、教友祈祷。" },
            { id: 14, title: "第十四处", name: "耶稣葬于墓", scripture: "“他在坟墓门口滚上一块大石头。” (玛27:60)", med: "坟墓不是终点是复活摇篮。我在大石头后等待，带着满怀的希望。", prayer: "主耶稣，守护我的信心，预见复活。阿们。", res: "写下一件期待在复活节改过的志向存入圣经。" }
        ];

        const confessionContentData = {
            examItems: [
                { cat: "天主十诫 (深入省察)", items: [
                    {q:"第一诫：忽略每日祈祷？迷信算命？把金钱看重于天主？", id:"c1"},
                    {q:"第二诫：乱用主名？发虚誓？对圣物礼仪不敬？", id:"c2"},
                    {q:"第三诫：主日无故缺席弥撒？弥撒中玩手机分心？", id:"c3"},
                    {q:"第四诫：不孝敬父母？顶撞长辈？忽略子女信仰？", id:"c4"},
                    {q:"第五诫：怀恨他人？伤害身体？教唆堕胎？放纵恶习？", id:"c5"},
                    {q:"第六九诫：看色情影像？婚外情/手淫？言行轻浮？", id:"c6"},
                    {q:"第七十诫：偷窃挪用？工作偷懒？借不还？嫉妒？", id:"c7"},
                    {q:"第八诫：说谎欺骗？诽谤传闲话？泄露隐私？", id:"c8"}
                ]},
                { cat: "七罪宗", items: [
                    {q:"骄傲、悭吝、迷色", id:"s1"},
                    {q:"愤怒、贪饕、嫉妒、懒惰", id:"s2"}
                ]}
            ],
            steps: [
                { t: "1. 进场准备", d: "怀谦卑心。画十字说：‘请神父降福，我罪人愿悔改...’" },
                { t: "2. 坦诚告明", d: "诚实说出罪过。完结说：‘还有省察不到的罪，求主宽恕。’" },
                { t: "3. 听劝补赎", d: "聆听劝诫，记住‘补赎’内容（经文或善行）。" },
                { t: "4. 念痛悔经", d: "神父念赦免经时，低头诚心诵念痛悔经。" },
                { t: "5. 赦罪平安", d: "神父画十字后答：‘感谢天主。’ 带着新生喜乐走出。" }
            ]
        };

        const holyWeekPlan = [
            { day: "圣枝主日 (3/29)", title: "基督受难主日", focus: "欢迎和平之王进城奉献。礼仪由欢呼转入受难福音。", liturgy: "祝圣圣枝、圣枝游行、长篇受难史宣读。", act: "带回圣枝放在家中十字架旁。反思：我在行动中抛弃主了吗？" },
            { day: "圣周一至三", title: "心灵静默期", focus: "大扫除最后时机。默想救主如何被推向加尔瓦略山。", liturgy: "早晨弥撒，堂区安排全天候告解。", act: "务必在此期间完成圣事告解。保持环境肃静。" },
            { day: "圣周四 (4/2)", title: "逾越节三日庆典", focus: "建立圣体与爱德诫命。主在此夜为门徒洗脚。", liturgy: "濯足礼；迁圣体；剥除祭台装饰。", act: "朝拜圣体至深夜（陪伴山园中的主）。" },
            { day: "圣周五 (4/3)", title: "救主受难纪念", focus: "十字架上的伟大赎献。天主为人类而死。", liturgy: "全日无弥撒。朝拜十字架。严守大小斋。", act: "下午3点绝对静默。在圣堂亲吻主受难伤痕。" },
            { day: "圣周六 (4/4)", title: "逾越节守夜礼", focus: "由死亡经过进入生命的时刻。礼仪之母。", liturgy: "祝圣新火、复活宣报、重申洗礼誓愿。", act: "晚上全程参与守夜礼。迎接真光复活。" },
            { day: "复活节 (4/5)", title: "耶稣复活瞻礼", focus: "死亡被废除了！基督得胜了！这是信仰根基。", liturgy: "欢唱阿肋路亚，弥撒充满白金荣光。", act: "庆祝复活！立志从此活出光明生活。" }
        ];

        const encyclopediaData = [
            { cat: "逾越节奥迹", desc: "‘逾越’意为‘经过’。旧约是天主拯救子民脱离奴役。新约中，基督是逾越羔羊：\n1. 经过自我（圣周四）：空虚自己建立圣体。\n2. 经过痛苦（圣周五）：走入死亡深渊。\n3. 经过阴府（圣周六）：救拔古圣先贤。\n4. 经过死亡（复活日）：彻底粉碎死亡。" },
            { cat: "大小斋规则", desc: "• 小斋：每周五。不食禽兽肉。满14岁适用。\n• 大斋：圣灰礼仪日、圣周五。全日仅进一餐饱食，禁零食。满18岁至60岁适用（病弱者可豁免，以爱德补之）。" },
            { cat: "洗礼更新", desc: "四旬期核心是‘圣洗预备期’。对已领洗信友，则是洗礼誓愿的重新激活。我们通过克己祈祷，准备在复活夜重申：‘我拒绝魔鬼，我信赖天主。’" }
        ];

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            const footer = document.getElementById('exam-footer');
            const quote = document.getElementById('quote-card');
            
            if(tabId === 'confession') {
                footer.classList.remove('hidden');
                quote.classList.add('hidden'); // 告解页隐藏名言防遮挡
            } else {
                footer.classList.add('hidden');
                quote.classList.remove('hidden');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showConfSub(subId) {
            document.querySelectorAll('.conf-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(subId).classList.remove('hidden');
            document.querySelectorAll('.conf-sub-btn').forEach(btn => { 
                btn.classList.remove('conf-nav-active'); 
                btn.classList.add('text-indigo-700'); 
            });
            document.getElementById('btn-' + subId).classList.add('conf-nav-active');
            document.getElementById('btn-' + subId).classList.remove('text-indigo-700');
        }

        function getPlanForDate(dateStr) {
            if(dailyFullPlan[dateStr]) return dailyFullPlan[dateStr];
            const isFri = new Date(dateStr).getDay() === 5;
            return { mentor: "在寂静中跟随主，在祈祷中获力量。", p: "阅读并深度默想当日礼仪读经", f: isFri ? "【小斋】今日戒食肉食；禁绝媒体娱乐" : "节制一项感官爱好", a: isFri ? "参与堂区拜苦路" : "今日默默进行一件爱德善功" };
        }

        function initProgressSystem() {
            const start = new Date(config.startDate);
            const today = new Date(); 
            const dateKey = today.toISOString().split('T')[0];
            const diffMs = today - start;
            const diffDays = Math.ceil(Math.max(0, diffMs / (1000 * 60 * 60 * 24)));
            const weekIdx = Math.floor((diffDays - 1) / 7);

            let displayDays = Math.max(0, Math.min(diffDays, 46));
            document.getElementById('progress-bar').style.width = `${(displayDays / 46) * 100}%`;
            document.getElementById('progress-week-text').innerText = diffDays <= 4 ? "圣灰后" : `四旬期第 ${weekIdx + 1} 周`;
            document.getElementById('progress-text').innerText = `Day ${displayDays} / 46`;
            document.getElementById('today-date-string').innerText = dateKey;

            document.getElementById('milestones-container').innerHTML = config.milestones.map((m, i) => `<div class="milestone-dot w-3 h-3 rounded-full border border-violet-500 pointer-events-auto ${diffDays >= m.offset ? 'active-dot' : 'bg-violet-900/40'}"></div>`).join('');

            const plan = getPlanForDate(dateKey);
            document.getElementById('dynamic-guidance-text').innerText = plan.mentor;
            renderHomeTasks(plan, dateKey);
        }

        function renderHomeTasks(plan, dateKey) {
            const cats = [
                { n: '祈祷 (Prayer)', i:'book-open', c:'text-purple-600', t:[plan.p, "晚间省察：寻找今日三个恩赐"] },
                { n: '斋戒 (Fasting)', i:'coffee', c:'text-indigo-600', t:[plan.f, "言语节制：不抱怨，不说闲话"] },
                { n: '爱德 (Almsgiving)', i:'heart', c:'text-rose-600', t:[plan.a, "耐心宽恕：对难相处的人保持微笑"] }
            ];
            document.getElementById('task-categories').innerHTML = cats.map((cat, cIdx) => `
                <div class="space-y-3"><h4 class="text-[10px] font-black uppercase tracking-[0.2em] ${cat.c} flex items-center gap-2"><i data-lucide="${cat.i}" class="w-3.5 h-3.5"></i> ${cat.n}</h4>
                    <div class="space-y-2.5">${cat.t.map((item, tIdx) => {
                        const taskId = `task_${dateKey}_${cIdx}_${tIdx}`;
                        const isDone = localStorage.getItem(taskId) === 'true';
                        return `<div onclick="toggleTask('${taskId}', this)" class="task-item flex items-start gap-4 p-4 rounded-[1.2rem] border ${isDone ? 'is-checked border-green-300' : 'border-gray-100 bg-gray-50/50'} cursor-pointer hover:bg-white shadow-sm transition-all"><div class="check-box w-6 h-6 rounded-[10px] border-2 border-violet-200 flex items-center justify-center bg-white shrink-0 mt-0.5"><i data-lucide="check" class="check-svg w-3 h-3 text-white ${isDone ? '' : 'hidden'}"></i></div><span class="text-[13px] font-bold text-gray-800 leading-relaxed">${item}</span></div>`;
                    }).join('')}</div></div>
            `).join('');
        }

        function toggleTask(id, el) {
            const isDone = el.classList.toggle('is-checked');
            el.querySelector('.check-svg').classList.toggle('hidden');
            if(isDone) localStorage.setItem(id, 'true'); else localStorage.removeItem(id);
        }

        function renderWeeklyList() { document.getElementById('weekly-list').innerHTML = weeklyFullData.map(w => `<div class="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm relative overflow-hidden"><div class="flex items-center justify-between mb-5 border-b border-gray-50 pb-5"><h4 class="text-xl font-black text-gray-900 tracking-tighter">${w.theme}</h4><span class="text-[9px] bg-violet-100 text-violet-700 px-3 py-1.5 rounded-full font-black uppercase tracking-widest">${w.week}</span></div><div class="mb-6 p-5 bg-violet-50 rounded-[1.5rem] border border-violet-100"><p class="text-[12px] text-violet-950 font-bold leading-[2] italic font-serif-church">“${w.intro}”</p><p class="text-[10px] text-violet-500 mt-3 font-black tracking-widest flex items-center gap-1.5"><i data-lucide="bookmark" class="w-3 h-3"></i> 读经: ${w.scripture}</p></div><div class="bg-stone-50 p-5 rounded-[1.5rem] border border-stone-100"><h5 class="text-[9px] font-black text-stone-400 uppercase tracking-widest mb-4">本周每日方案</h5><div class="space-y-3">${w.days.map((d, i) => `<div class="text-[12px] text-gray-700 leading-relaxed flex gap-3"><span class="font-black text-violet-400 shrink-0">D${i+1}</span><p class="font-medium">${d}</p></div>`).join('')}</div></div></div>`).join(''); }
        
        function renderStationsList() { document.getElementById('stations-list').innerHTML = stationsDetailed.map(s => `<div class="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm station-accent"><div class="flex justify-between items-center mb-5"><span class="text-[10px] font-black text-stone-400 uppercase tracking-widest">${s.title}</span><div class="w-10 h-10 rounded-[12px] bg-stone-900 text-white flex items-center justify-center text-sm font-black shadow-md">${s.id}</div></div><h4 class="text-xl font-black text-stone-950 mb-4 tracking-tight">${s.name}</h4><div class="p-5 bg-stone-50 rounded-[1.5rem] border border-stone-100 mb-5 font-serif-church italic text-stone-800 text-[13px] leading-[2]">${s.scripture}</div><div class="space-y-5"><div class="prose-church"><h5 class="text-[10px] font-black text-stone-400 uppercase tracking-widest mb-2 flex items-center gap-1.5">神学默想</h5><p class="text-[13px] text-gray-600 font-medium leading-[1.8]">“${s.med}”</p></div><div class="bg-violet-50 p-5 rounded-[1.5rem] border border-violet-100"><strong class="flex items-center gap-2 mb-2 text-[10px] text-violet-700 uppercase tracking-widest font-black"><i data-lucide="target" class="w-3.5 h-3.5"></i> 今日定志行动</strong><p class="text-[13px] text-violet-950 font-bold leading-relaxed">${s.res}</p></div><div class="bg-indigo-50/50 p-4 rounded-[1.2rem] italic text-[11px] text-indigo-700 font-medium leading-relaxed"><strong>经文祷词：</strong> ${s.prayer}</div></div></div>`).join(''); }
        
        function renderHolyWeekPlan() { document.getElementById('holyweek-list').innerHTML = holyWeekPlan.map(h => `<div class="bg-white p-6 rounded-[2rem] border-l-[8px] border-l-red-900 shadow-sm space-y-5"><div class="flex flex-col gap-2"><span class="text-[9px] font-black text-red-700 uppercase tracking-widest border border-red-100 px-3 py-1 rounded-full w-fit bg-red-50">${h.day}</span><h3 class="text-xl font-black text-red-950 tracking-tighter">${h.title}</h3></div><div class="space-y-3"><div class="p-5 bg-gray-50 rounded-[1.5rem] border border-gray-100"><h5 class="text-[9px] font-black text-gray-400 uppercase tracking-widest mb-2">焦点</h5><p class="text-[13px] text-gray-700 font-medium leading-[1.8]">${h.focus}</p></div><div class="p-5 bg-red-50/50 rounded-[1.5rem] border border-red-100"><h5 class="text-[9px] font-black text-red-800 uppercase tracking-widest mb-2">礼仪</h5><p class="text-[13px] text-red-900 font-bold leading-[1.8]">${h.liturgy}</p></div></div><div class="bg-red-900 p-6 rounded-[1.5rem] text-white shadow-md"><p class="text-[13px] font-bold leading-relaxed flex items-start gap-3 italic font-serif-church"><i data-lucide="heart" class="w-4 h-4 fill-white text-red-900 mt-1 shrink-0"></i>“${h.act}”</p></div></div>`).join(''); }
        
        function renderEncyclopedia() { document.getElementById('liturgy-info-list').innerHTML = encyclopediaData.map(i => `<div class="bg-white p-8 rounded-[2rem] shadow-sm border border-amber-50"><h4 class="text-amber-950 font-black text-xl mb-5 flex items-center gap-3"><span class="w-10 h-10 bg-amber-100 text-amber-700 rounded-[12px] flex items-center justify-center"><i data-lucide="book-open" class="w-5 h-5"></i></span>${i.cat}</h4><p class="text-[13px] text-gray-600 leading-[2] whitespace-pre-line font-medium prose-church">${i.desc}</p></div>`).join(''); }
        
        function renderConfData() {
            document.getElementById('exam-list-container').innerHTML = confessionContentData.examItems.map(section => `<div class="space-y-5"><h4 class="font-black text-indigo-950 text-lg flex items-center gap-2.5"><span class="w-1.5 h-6 bg-indigo-600 rounded-full"></span> ${section.cat}</h4><div class="space-y-3">${section.items.map(q => { const isDone = localStorage.getItem(`conf_${q.id}`) === 'true'; return `<div onclick="toggleExamCheck(this, '${q.id}', '${q.q.split('？')[0]}')" class="exam-item flex items-start gap-4 p-4 rounded-[1.5rem] border ${isDone ? 'is-checked border-indigo-300' : 'border-gray-100 bg-gray-50/30'} cursor-pointer transition-all"><div class="exam-check-box w-6 h-6 rounded-[8px] border-2 border-indigo-200 shrink-0 mt-0.5 flex items-center justify-center bg-white"><i data-lucide="check" class="exam-check-svg w-3.5 h-3.5 text-white ${isDone ? '' : 'hidden'}"></i></div><p class="text-[13px] text-gray-700 leading-[1.8] font-medium">${q.q}</p></div>`; }).join('')}</div></div>`).join('');
            
            document.getElementById('confession-script').innerHTML = confessionContentData.steps.map((s, i) => `<div class="relative pl-10 border-l-2 border-dashed border-indigo-100 pb-8 last:pb-0"><div class="absolute -left-[15px] top-0 w-7 h-7 rounded-[8px] bg-indigo-600 text-white flex items-center justify-center text-xs font-black border-[3px] border-white">${i+1}</div><h5 class="font-black text-indigo-950 text-sm mb-2 tracking-tight">${s.t}</h5><div class="bg-gray-50 p-4 rounded-2xl text-[12px] text-gray-600 font-medium leading-relaxed">${s.d}</div></div>`).join('');
            
            document.getElementById('prayers-container').innerHTML = `<div class="space-y-4"><h4 class="text-lg font-black text-indigo-950 border-l-4 border-indigo-600 pl-3">白话版痛悔经</h4><p class="text-[13px] leading-relaxed text-gray-700 bg-indigo-50/50 p-5 rounded-2xl">天主，为了我所犯的一切罪过...我全心痛悔。我决志藉着祢的恩宠，再不敢得罪祢，并躲避犯罪的机会。阿们。</p></div><div class="space-y-4 mt-6"><h4 class="text-lg font-black text-indigo-400 border-l-4 border-indigo-400 pl-3">文言版痛悔经</h4><p class="text-[13px] leading-relaxed text-gray-600 bg-gray-50 p-5 rounded-2xl font-serif-church italic">吾主耶稣，基利斯督...我重罪人，得罪天主。今特为爱天主在万有之上，专心痛悔...宁死再不敢得罪天主。阿们。</p></div>`;
            updateExamBadge();
        }

        function toggleExamCheck(el, id, text) {
            const isChecked = el.classList.toggle('is-checked');
            el.querySelector('.exam-check-svg').classList.toggle('hidden');
            if (isChecked) { localStorage.setItem(`conf_${id}`, 'true'); localStorage.setItem(`conf_text_${id}`, text); } 
            else { localStorage.removeItem(`conf_${id}`); localStorage.removeItem(`conf_text_${id}`); }
            updateExamBadge();
        }
        function updateExamBadge() { document.getElementById('exam-badge').innerText = document.querySelectorAll('.exam-item.is-checked').length; }
        
        function copyConfessionList() {
            let listText = "【告解备忘录】\n", hasItems = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('conf_text_')) { listText += "• " + localStorage.getItem(key) + "...\n"; hasItems = true; }
            }
            if (!hasItems) return alert("您还没有勾选任何条目。");
            navigator.clipboard.writeText(listText).then(() => alert("已复制！排队办告解时可粘贴到备忘录中查看。"));
        }
        
        function resetExam() {
            if(confirm("确定要清空告解记录吗？")) {
                let keys = [];
                for(let i=0; i<localStorage.length; i++) { if(localStorage.key(i).startsWith('conf_')) keys.push(localStorage.key(i)); }
                keys.forEach(k => localStorage.removeItem(k));
                renderConfData();
            }
        }

        window.onload = () => {
            try {
                initProgressSystem();
                renderWeeklyList();
                renderStationsList();
                renderConfData();
                renderHolyWeekPlan();
                renderEncyclopedia();

                if(typeof lucide !== 'undefined') lucide.createIcons();
                
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);

                // 随机名言轮播
                setInterval(() => {
                    const el = document.getElementById('daily-quote');
                    const card = document.getElementById('quote-card');
                    if(el && !card.classList.contains('hidden')) {
                        el.parentElement.style.opacity = '0';
                        setTimeout(() => { 
                            el.innerText = quotes[Math.floor(Math.random() * quotes.length)];
                            el.parentElement.style.opacity = '1'; 
                        }, 700);
                    }
                }, 10000);

                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js').catch(console.error);
                }
            } catch (error) {
                document.getElementById('loading-screen').style.display = 'none';
                throw error;
            }
        };
    </script>
</body>
</html>
