<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 善度四旬期与告解圣事深度全指南</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6d28d9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="四旬期指南">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js" defer></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Noto+Serif+SC:wght@400;700;900&display=swap');
        
        :root { 
            --church-violet: #6d28d9; 
            --church-indigo: #4338ca; 
            --church-emerald: #10b981; 
        }
        
        body { 
            font-family: 'Noto Sans SC', sans-serif; 
            background-color: #f8f7fc; 
            color: #111827; 
            scroll-behavior: smooth; 
            -webkit-tap-highlight-color: transparent; 
        }
        
        .font-serif-church { font-family: 'Noto Serif SC', serif; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .milestone-dot { transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; background-color: rgba(139, 92, 246, 0.4); }
        .active-dot { background-color: white !important; box-shadow: 0 0 10px rgba(255,255,255,0.8); transform: scale(1.35); }
        
        .task-item.is-checked { background-color: #f0fdf4 !important; border-color: #86efac !important; }
        .task-item.is-checked .check-box { background-color: #22c55e !important; border-color: #22c55e !important; }
        .task-item.is-checked .check-svg { display: block !important; }
        
        .exam-item.is-checked { background-color: #eef2ff !important; border-color: #a5b4fc !important; }
        .exam-item.is-checked .exam-check-box { background-color: #4f46e5 !important; border-color: #4f46e5 !important; }
        .exam-item.is-checked .exam-check-svg { display: block !important; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .shadow-premium { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .station-accent { border-left: 4px solid #4b5563; }
        .station-accent:hover { border-left-color: #7c3aed; }
        .conf-nav-active { background-color: #4f46e5 !important; color: white !important; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); }
        .prose-church { line-height: 2; letter-spacing: 0.01em; }
    </style>
</head>
<body class="pb-40">
    
    <div id="loading-screen" class="fixed inset-0 bg-[#f8f7fc] z-[999] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-10 h-10 border-4 border-violet-200 border-t-violet-700 rounded-full animate-spin mb-4"></div>
        <p class="text-violet-900 font-bold text-xs">正在加载堂区灵修资源...</p>
    </div>

    <header class="bg-white/95 backdrop-blur-xl border-b sticky top-0 z-[100] pt-[env(safe-area-inset-top)]">
        <div class="max-w-2xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="showTab('home')">
                <div class="bg-violet-700 p-2 rounded-[14px] text-white shadow-md">
                    <i data-lucide="cross" class="w-5 h-5"></i>
                </div>
                <div>
                    <h1 class="text-[16px] font-black text-violet-950 leading-none tracking-tight">2026 善度四旬期</h1>
                    <span class="text-[9px] text-violet-500 uppercase tracking-widest font-bold mt-1 block">深度灵修与告解指南</span>
                </div>
            </div>
            <button onclick="showTab('liturgy')" class="text-[11px] font-black px-4 py-2 rounded-full text-violet-700 bg-violet-50 border border-violet-100 flex items-center gap-1.5">
                <i data-lucide="info" class="w-3.5 h-3.5"></i> 百科
            </button>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-4 py-6">
        
        <div id="home" class="tab-content active space-y-6">
            
            <div class="bg-gradient-to-br from-violet-800 via-violet-950 to-indigo-950 rounded-[2rem] p-6 text-white shadow-xl relative overflow-hidden">
                <div class="absolute -right-10 -bottom-10 w-32 h-32 bg-white/5 rounded-full blur-2xl"></div>
                <div class="flex justify-between items-center mb-8">
                    <div class="flex items-center gap-2.5">
                        <div class="bg-white/10 p-2 rounded-xl backdrop-blur-md"><i data-lucide="compass" class="w-4 h-4 text-violet-200"></i></div>
                        <span id="progress-week-text" class="font-black text-sm tracking-wide">载入进度...</span>
                    </div>
                    <span id="progress-text" class="bg-white/20 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">Day 0 / 46</span>
                </div>
                <div class="relative px-1 mb-12">
                    <div class="w-full bg-white/10 rounded-full h-2.5 overflow-hidden shadow-inner">
                        <div id="progress-bar" class="bg-white h-full rounded-full transition-all duration-1000 shadow-[0_0_15px_rgba(255,255,255,0.6)]" style="width: 0%"></div>
                    </div>
                    <div id="milestones-container" class="absolute top-1/2 -translate-y-1/2 w-full left-0 px-0 flex justify-between pointer-events-none"></div>
                    <div class="absolute w-full flex justify-between mt-5 px-0 text-[7px] font-black opacity-90 leading-tight">
                        <div class="flex flex-col items-center w-10 -ml-3 text-center"><span>圣灰礼仪</span><span class="opacity-50 mt-0.5">2/18</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第一主日</span><span class="opacity-50 mt-0.5">2/22</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第二主日</span><span class="opacity-50 mt-0.5">3/01</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第三主日</span><span class="opacity-50 mt-0.5">3/08</span></div>
                        <div class="flex flex-col items-center w-10 text-center"><span>第四主日</span><span class="opacity-50 mt-0.5">3/15</span></div>
                        <div class="flex flex-col items-center w-10 text-center text-amber-300"><span>第五主日</span><span class="opacity-50 mt-0.5">3/22</span></div>
                        <div class="flex flex-col items-center w-10 text-red-300"><span>圣枝</span><span class="opacity-50 mt-0.5">3/29</span></div>
                        <div class="flex flex-col items-center w-10 -mr-3 text-yellow-300 text-center"><span>复活节</span><span class="opacity-50 mt-0.5">4/05</span></div>
                    </div>
                </div>
                <div class="flex justify-between items-end text-[10px] opacity-70 border-t border-white/10 pt-3">
                    <div><span class="font-bold">2026 四旬期旅程</span></div>
                    <div class="text-right"><span id="today-date-string" class="text-xs font-black tracking-tighter block">载入中...</span></div>
                </div>
            </div>

            <div class="bg-gray-50 border border-gray-200 rounded-2xl p-3 text-center shadow-sm">
                <p class="text-[10px] text-gray-500 font-bold flex items-center justify-center gap-1.5">
                    <i data-lucide="shield-check" class="w-3.5 h-3.5 text-emerald-500"></i>
                    声明：此为纯静态网页，我们不会读取您的个人信息，您的打卡记录与告解清单仅保存在本机，请放心使用。
                </p>
            </div>

            <div class="bg-amber-50 border border-amber-200 rounded-[1.5rem] p-5 flex gap-4 items-center shadow-sm relative overflow-hidden">
                <div class="w-12 h-12 bg-amber-100 text-amber-700 rounded-2xl flex items-center justify-center flex-shrink-0 shadow-inner"><i data-lucide="bell" class="w-6 h-6 animate-bounce"></i></div>
                <div class="flex-1">
                    <h4 class="text-[13px] font-black text-amber-950 mb-1">深圳圣安多尼堂通知</h4>
                    <p class="text-[11px] text-amber-800 leading-relaxed font-bold">四旬期内每周五下午3点 <span class="bg-amber-200/50 px-1.5 py-0.5 rounded text-amber-900">15:00</span> 举行拜苦路善功，随后举行弥撒。请踊跃参与。</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="showTab('weekly')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-violet-50 text-violet-600 flex items-center justify-center mb-3"><i data-lucide="layers" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">每周重点</span>
                </button>
                <button onclick="showTab('stations')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-stone-50 text-stone-700 flex items-center justify-center mb-3"><i data-lucide="milestone" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">苦路善功</span>
                </button>
                <button onclick="showTab('confession')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-indigo-50 text-indigo-700 flex items-center justify-center mb-3"><i data-lucide="heart-handshake" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">告解圣事</span>
                </button>
                <button onclick="showTab('holyweek')" class="bg-white p-5 rounded-[1.5rem] flex flex-col items-center text-center shadow-sm border border-gray-100 hover:shadow-md transition-all">
                    <div class="w-12 h-12 rounded-[14px] bg-red-50 text-red-600 flex items-center justify-center mb-3"><i data-lucide="flame" class="w-6 h-6"></i></div>
                    <span class="text-[13px] font-black text-gray-800">圣周指南</span>
                </button>
            </div>

            <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="text-xl font-black text-gray-900 tracking-tight">今日修德方案</h3>
                        <p class="text-[9px] text-gray-400 font-bold uppercase tracking-widest mt-0.5">Spiritual Training</p>
                    </div>
                    <div class="bg-violet-100 text-violet-700 p-2.5 rounded-[14px]" onclick="alert('勾选的任务将自动保存在您的手机中，即使关闭网页也不会丢失哦！')"><i data-lucide="save" class="w-5 h-5"></i></div>
                </div>
                
                <div class="bg-violet-50 p-5 rounded-3xl mb-8 border border-violet-100/50 relative overflow-hidden">
                    <div class="absolute -right-2 -top-2 opacity-5"><i data-lucide="quote" class="w-16 h-16 text-violet-900"></i></div>
                    <h5 class="text-[10px] font-black text-violet-400 uppercase tracking-widest mb-2 flex items-center gap-1.5"><i data-lucide="message-circle" class="w-3 h-3"></i> 灵修指引</h5>
                    <p id="dynamic-guidance-text" class="text-[14px] text-violet-950 font-bold leading-relaxed italic font-serif-church relative z-10">载入中...</p>
                </div>
                <div id="task-categories" class="space-y-8"></div>
            </div>
            
            <footer class="pt-6 pb-2 text-center opacity-60">
                <p class="text-[9px] font-black tracking-widest uppercase mb-1">Produced By SAC</p>
                <p class="text-[10px] font-bold">划向深处小组制作</p>
            </footer>
        </div>

        <div id="weekly" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-violet-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-violet-950 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 rotate-12"><i data-lucide="scroll-text" class="w-32 h-32"></i></div>
                <h2 class="text-2xl font-black mb-4 tracking-tighter relative z-10">每周灵修大纲</h2>
                <p class="text-violet-200 leading-[1.8] text-[13px] font-medium prose-church relative z-10">四旬期是一场灵魂由世俗之“奴役”走向天主之“自由”的伟大法行。每周的主日福音都是这一段航程的灯塔。请通过每周深度的福音背景与生活操练方案，剥离旧我，迎接基督。</p>
            </div>
            <div id="weekly-list" class="space-y-8"></div>
        </div>

        <div id="stations" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-stone-700 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-stone-900 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute -right-4 -bottom-4 opacity-10"><i data-lucide="cross" class="w-40 h-40"></i></div>
                <h2 class="text-2xl font-black mb-4 tracking-tighter relative z-10">拜苦路深度默想</h2>
                <p class="text-stone-300 text-[13px] leading-[1.8] italic font-serif-church relative z-10">“谁若愿意跟随我，该弃绝自己，天天背起自己的十字架跟随我。” (路9:23)<br>请跟随基督的最后旅程，在每一处读经、默想并立下今日的定志。</p>
            </div>
            <div id="stations-list" class="space-y-8"></div>
        </div>

        <div id="confession" class="tab-content space-y-6 pb-20">
            <button onclick="showTab('home')" class="flex items-center text-indigo-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            
            <div class="bg-white p-1.5 rounded-[1.5rem] shadow-sm border border-indigo-50 flex items-center gap-1 sticky top-[4.5rem] z-50 overflow-x-auto no-scrollbar">
                <button onclick="showConfSub('conf-intro')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all conf-nav-active" id="btn-conf-intro">意义</button>
                <button onclick="showConfSub('conf-prep')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-prep">准备</button>
                <button onclick="showConfSub('conf-exam')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-exam">省察清单</button>
                <button onclick="showConfSub('conf-step')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-step">流程</button>
                <button onclick="showConfSub('conf-prayer')" class="conf-sub-btn whitespace-nowrap flex-1 py-2.5 px-4 rounded-full text-[11px] font-black transition-all text-indigo-700" id="btn-conf-prayer">经文</button>
            </div>

            <div id="conf-intro" class="conf-section space-y-6">
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-indigo-50 leading-[2] text-[13px] prose-church text-gray-700">
                    <div class="w-12 h-12 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mb-6"><i data-lucide="sparkles" class="w-6 h-6"></i></div>
                    <h3 class="text-xl font-black text-indigo-950 mb-4">重拾和好的喜乐</h3>
                    <p class="mb-6 font-bold text-gray-900">告解圣事是天主慈悲的具体体现。耶稣不仅赦免罪过，更治愈受伤的心灵。</p>
                    <ul class="space-y-3">
                        <li class="flex gap-3 p-4 bg-indigo-50/50 rounded-2xl border border-indigo-50"><i data-lucide="check-circle" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i><span><b>洗净罪污：</b> 彻底宽赦罪过，重新焕发光辉。</span></li>
                        <li class="flex gap-3 p-4 bg-indigo-50/50 rounded-2xl border border-indigo-50"><i data-lucide="check-circle" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i><span><b>确切平安：</b> 亲耳听到‘我赦免你的罪’。</span></li>
                    </ul>
                </div>
            </div>
            
            <div id="conf-prep" class="conf-section hidden space-y-6">
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-indigo-100">
                    <h3 class="text-xl font-black text-indigo-950 mb-5 flex items-center gap-2"><i data-lucide="hourglass" class="w-5 h-5 text-indigo-500"></i> 告解前的预备</h3>
                    <div class="space-y-4 text-[13px] text-gray-600 prose-church">
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">1. 静下心来</h4><p>寻找安静角落，面对仁慈的父亲。</p></div>
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">2. 祈求光照</h4><p>祈求圣神照亮记忆，赐予痛悔力量。</p></div>
                        <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100"><h4 class="font-black text-gray-900 mb-1">3. 诚实面对</h4><p>不要找借口，坦诚说：‘我做了这件事，我很后悔。’</p></div>
                        <div class="bg-indigo-600 p-6 rounded-2xl text-white mt-2">
                            <h5 class="font-black text-[10px] uppercase tracking-widest mb-2 opacity-70">准备祷词</h5>
                            <p class="text-[14px] italic font-serif-church font-bold leading-relaxed">“我主、我神！我承认我多次犯罪...求祢宽恕我的罪，并赐我改过的决心。阿们。”</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="conf-exam" class="conf-section hidden space-y-8">
                <div class="bg-indigo-950 text-white p-8 rounded-[2rem] shadow-md relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-10 rotate-12"><i data-lucide="clipboard-list" class="w-32 h-32"></i></div>
                    <h3 class="text-xl font-black mb-2 relative z-10 flex items-center gap-2"><i data-lucide="search" class="w-5 h-5 text-indigo-400"></i> 灵魂全备省察清单</h3>
                    <p class="text-[11px] text-indigo-200 leading-[1.8] relative z-10">点击各项记录到待告明清单（仅存本机）。主已知道一切，祂只想听见您的诚实。</p>
                </div>
                <div id="exam-list-container" class="space-y-10"></div>
            </div>

            <div id="conf-step" class="conf-section hidden space-y-6">
                <div id="confession-script" class="bg-white p-6 rounded-[2rem] border border-indigo-50 space-y-8"></div>
            </div>

            <div id="conf-prayer" class="conf-section hidden space-y-6">
                <div class="bg-white p-8 rounded-[2rem] border border-indigo-100 shadow-sm space-y-8" id="prayers-container"></div>
            </div>
        </div>

        <div id="holyweek" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-red-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-red-950 text-white p-8 rounded-[2rem] shadow-xl relative overflow-hidden">
                <div class="absolute -left-10 -bottom-10 w-32 h-32 bg-red-500 opacity-20 rounded-full blur-[40px]"></div>
                <h2 class="text-2xl font-black mb-3 tracking-tighter relative z-10">圣周深度指南</h2>
                <p class="text-red-200 leading-[1.8] text-[13px] font-medium prose-church relative z-10">逾越节三日庆典是救恩史巅峰。我们将跟随基督由最后的晚餐进入山园的忧闷，经由苦路走上加尔瓦略山，并在第三日见证死亡的终结。</p>
            </div>
            <div id="holyweek-list" class="space-y-8"></div>
        </div>

        <div id="liturgy" class="tab-content space-y-8 pb-10">
            <button onclick="showTab('home')" class="flex items-center text-amber-600 font-black text-sm gap-2 mb-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> 返回主页</button>
            <div class="bg-amber-100 p-8 rounded-[2rem] border border-amber-200 shadow-inner">
                <h2 class="text-2xl font-black text-amber-950 mb-2 tracking-tighter">四旬期小知识</h2>
                <p class="text-amber-900/70 text-[12px] font-bold italic font-serif-church">探索 40 天旷野旅程背后的神学奥秘与教会传统。</p>
            </div>
            <div id="liturgy-info-list" class="space-y-8"></div>
        </div>
    </main>

    <div id="exam-footer" class="fixed bottom-24 left-1/2 -translate-x-1/2 w-full max-w-sm px-4 hidden z-[110] transition-transform duration-500">
        <div class="bg-indigo-950 text-white p-3.5 rounded-full shadow-2xl flex justify-between items-center border border-indigo-700 ring-4 ring-indigo-900/40">
            <div class="flex items-center gap-3 pl-2">
                <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center font-black text-lg shadow-inner" id="exam-badge">0</div>
                <span class="text-[10px] font-black uppercase text-indigo-300 tracking-[0.1em] leading-tight">已记下告解事项</span>
            </div>
            <div class="flex gap-2 pr-1">
                <button onclick="copyConfessionList()" class="text-[10px] bg-indigo-500/20 px-4 py-2.5 rounded-full font-black hover:bg-indigo-500/40 border border-indigo-400/30 flex items-center gap-1"><i data-lucide="copy" class="w-3.5 h-3.5"></i> 复制</button>
                <button onclick="resetExam()" class="text-[10px] bg-red-500/20 px-4 py-2.5 rounded-full font-black hover:bg-red-500/40 border border-red-400/30 flex items-center gap-1"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i> 清空</button>
            </div>
        </div>
    </div>

    <div id="quote-card" class="fixed bottom-6 md:bottom-8 left-1/2 -translate-x-1/2 w-full max-w-md px-4 pointer-events-none transition-opacity duration-700 z-[120]">
        <div class="bg-white/95 backdrop-blur-xl shadow-lg border border-violet-100/50 p-4 rounded-[1.5rem] flex items-center gap-4 pointer-events-auto border-t-4 border-t-violet-600">
            <div class="bg-violet-600 p-2.5 rounded-xl text-white shadow-md flex-shrink-0">
                <i data-lucide="sparkles" class="w-4 h-4 animate-pulse"></i>
            </div>
            <p id="daily-quote" class="text-[12px] font-black text-violet-950 leading-relaxed italic font-serif-church">“你们应回头改过，信从福音。”</p>
        </div>
    </div>

    <div id="error-output" class="hidden fixed inset-0 bg-white z-[9999] p-8 overflow-auto text-red-600 font-mono text-sm"></div>

    <script>
        // 错误捕获逻辑
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const ls = document.getElementById('loading-screen');
            if(ls) ls.style.display = 'none';
            const errDiv = document.getElementById('error-output');
            if(errDiv) {
                errDiv.classList.remove('hidden');
                errDiv.innerHTML += `<p>Error: ${msg} <br>Line: ${lineNo}</p>`;
            }
            return false;
        };

        // ================= 完整深度数据区 =================
        
        const quotes = [
            "“记住：你原来是尘土，将来仍要归于尘土。”",
            "“斋戒不只是空肚子，更是为了腾出空间给天主。”",
            "“施舍不是给予我们多余的，而是分享我们必需的。”",
            "“祈祷是让天主的手去塑造我们的灵魂。”",
            "“在这个四旬期，让我们多一点仁慈，少一点评判。”",
            "“旷野不是惩罚，而是聆听天主微弱声音的圣殿。”",
            "“最大的禁食，是戒绝心中的骄傲与贪婪。”",
            "“基督的受难是爱的极致，我们的悔改是对爱的响应。”"
        ];

        const config = { 
            startDate: '2026-02-18', 
            milestones: [
                { offset: 0, title: '圣灰礼仪', date: '2/18' }, 
                { offset: 4, title: '第一主日', date: '2/22' }, 
                { offset: 11, title: '第二主日', date: '3/1' }, 
                { offset: 18, title: '第三主日', date: '3/8' }, 
                { offset: 25, title: '第四主日', date: '3/15' }, 
                { offset: 32, title: '第五主日', date: '3/22' }, 
                { offset: 39, title: '圣枝主日', date: '3/29' }, 
                { offset: 46, title: '复活主日', date: '4/5' }
            ] 
        };

        // 完整还原的 18 天修德方案（融合了初稿与深度版的全部文本）
        const dailyFullPlan = {
            "2026-02-18": { mentor: "【圣灰礼仪】灰烬的记号提醒我们生命的脆弱，也预示复活的新生。今日请深度默想这一场由尘土走向永恒的逾越。", p: "参与圣灰礼仪弥撒；阅读并默想玛窦福音 6:1-6；晚间安静省察15分钟", f: "全守大斋小斋：全日进一饱餐，另两小餐相加不得多于一餐；禁食肉类及零食", a: "在圣堂慈善箱悄悄放入一笔款项，开始为期40天的爱德操练" },
            "2026-02-19": { mentor: "【旷野初探】耶稣被领入旷野。今日请刻意寻找一个物理上的‘安静角落’，听听被世俗掩盖的灵魂渴求。", p: "寻找苦像或圣体前练习15分钟绝对静默；诵念天主经5遍（缓慢且专注）", f: "戒绝今日所有的甜味饮品（奶茶/汽水/甜咖啡），尝试回归纯净白水的简单", a: "对今天遇到的每一个由于职责而为你服务的劳动者，致以注视对方眼睛的感谢" },
            "2026-02-20": { mentor: "【苦难周五】下午三点是主受难时刻。请暂时放下手中的繁忙，跪向十字架，陪伴那位为我舍命的救主。", p: "15:00 准时参与堂区拜苦路善功与随后举行的弥撒", f: "守小斋：戒食一切禽兽肉类；并斋戒今日所有的电子媒体感官娱乐（不刷视频）", a: "为一位你曾有过嫌隙或不愿提及的邻人默默代祷，祈求主赐予和解的种子" },
            "2026-02-21": { mentor: "【省察日】利未（玛窦）被召唤了。主不嫌弃罪人。今日请对照‘告解全指南’，为您的灵魂举行一次大扫除。", p: "进行深度省察，并尝试在今日或下周初办一次妥当告解；读圣咏第51篇", f: "今日不食用甜点，将饮食欲望控制在最基础的需求上，磨练意志", a: "整理家中三件不需要却长期占有的闲置物，计划捐赠给社会公益机构" },
            "2026-02-22": { mentor: "【第一主日】主受试探。耶稣用圣言反击。反思：什么是我目前最大的试探？是名望？是享乐？还是控制欲？", p: "参与主日大礼弥撒；深度默想玛窦福音 4:1-11 中主对魔鬼的回答", f: "主日不强制禁食，但应在社交媒体和言语上保持节制，活出属灵的清明", a: "全心陪伴家人或致电远方父母，在这段时间内完全关闭手机通知" },
            "2026-02-23": { mentor: "【修德日：谦卑】魔鬼诱惑主炫耀神迹。今日即便你完成了一项伟大的工作，也要在心中说：‘我是无用的仆人’。", p: "诵念圣母七苦经一段；默想圣母在隐居纳匝肋时那份不为人知的低微", f: "言语斋戒：今日不发表任何‘评价他人’的言论，即便是事实也不说，只说造就人的话", a: "秘密地为同事、家人或室友完成一件繁琐但必要的小事，绝对不让对方察觉" },
            "2026-02-24": { mentor: "【修德：慷慨】白白得来的，也要白白分施。", p: "为堂区神父代祷；读经15分钟", f: "感官斋戒：不点开娱乐爆料新闻", a: "在工作中多帮助一位新手" },
            "2026-02-25": { mentor: "【修德：温良】温良的人是有福的。", p: "默想耶稣洗脚；练习呼吸祈祷", f: "言语斋戒：不用冷嘲热讽的语气", a: "为堂区公益项目捐献" },
            "2026-02-26": { mentor: "【修德：信靠】将焦虑全然托付主手。", p: "圣体前静默20分钟；复述‘耶稣我信靠祢’", f: "物资节制：不看购物软件", a: "向久未联络的朋友问候倾听" },
            "2026-02-27": { mentor: "【苦难周五】陪伴走在加尔瓦略山上的主。", p: "15:00 参与堂区拜苦路；默想第十一处", f: "大小斋：进一饱餐，禁肉食", a: "为受病苦或失业折磨的人献苦路" },
            "2026-03-01": { mentor: "【第二主日：显容】在平凡生活中寻找主的荣光。", p: "参与主日弥撒；默想玛 17:1-9", f: "在社交媒体上保持克制", a: "致电远方父母或探望长辈" },
            "2026-03-08": { mentor: "【第三主日：活水】主啊，请赐我永不干涸的活水。", p: "参与主日弥撒；默想若 4:5-42", f: "减少感官消遣，增加深度阅读", a: "为堂区福传项目提供协助" },
            "2026-03-15": { mentor: "【第四主日：复明】主，请开启我灵魂的眼。", p: "参与主日弥撒；默想若 9:1-41", f: "喜乐主日，仍保持生活简朴", a: "关注并帮助身边的困难者" },
            "2026-03-22": { mentor: "【第五主日：复活预兆】主呼唤我们走出罪恶的坟墓。", p: "参与主日弥撒；默想若 11:1-45", f: "立志在复活节前改掉一个恶习", a: "为教友中的病弱临终者祈祷" },
            "2026-03-29": { mentor: "【圣枝主日】在心中欢迎君王进城。", p: "参与圣枝主日礼仪；圣枝置于苦像旁", f: "停止不必要的社交聚会", a: "原谅一位曾伤害过你的人" },
            "2026-04-02": { mentor: "【圣周四：最后晚餐】请陪伴山园中的主。", p: "参与建立圣体弥撒；朝拜圣体到深夜", f: "晚餐后保持绝对静默，与主共处", a: "效法基督洗脚，承担卑微家务" },
            "2026-04-03": { mentor: "【圣周五：救主受难】天主为我而死。", p: "参与受难日礼仪；亲吻苦像伤痕", f: "严守大小斋：禁食肉类", a: "下午三点保持绝对静默" },
            "2026-04-05": { mentor: "【复活大瞻礼】阿肋路亚！主真的复活了！", p: "参与隆重复活弥撒；重申洗礼誓愿", f: "结束斋戒，分享复活喜乐", a: "将复活喜讯带给邻人" }
        };

        const weeklyFullData = [
            { 
                week: "第一周", theme: "旷野与诱惑", focus: "分辨诱惑，操练自制。", scripture: "玛 4:1-11", 
                intro: "跟随耶稣进入旷野。我们要学习用圣言来抵挡‘肉欲、虚荣与权力’这三大诱惑。", 
                days: [
                    "主日：【福音】耶稣在旷野。焦点：识别我生命中的‘假神’（如金钱、面子）。",
                    "周一：【灵修指引】今日练习‘识别虚荣’。当你想炫耀成就时，请选择神圣的沉默。",
                    "周二：【灵修指引】今日练习‘物欲节制’。拒绝购买一件并非生活必需的物品。",
                    "周三：【灵修指引】今日练习‘诚实’。在琐事上绝不说谎，不为了面子而夸张。",
                    "周四：【灵修指引】今日练习‘代祷’。为那些深陷网瘾或感官欲望不能自拔者代祷。",
                    "周五：【受难】参与圣安多尼堂拜苦路。守大小斋。感受十字架真实的沉重。",
                    "周六：【谦卑】今日练习‘无名善行’。做一件帮助邻里的好事，且绝不让对方知道。"
                ] 
            },
            { 
                week: "第二周", theme: "显容与光荣", focus: "在苦难阴影中仰望真光。", scripture: "玛 17:1-9", 
                intro: "显容是为了告诉门徒：苦难不是终点。我们要练习在琐碎暗淡的生活里，认出基督的荣光。", 
                days: [
                    "主日：【福音】山上显容。焦点：在平凡的工作与繁琐家务中认出主的荣光。",
                    "周一：【灵修指引】今日信心操练：遇到让你沮丧的事，立即复述：‘主，我相信祢。’",
                    "周二：【灵修指引】今日心境整理：摒弃因焦虑产生的杂念，将控制权交还给天主。",
                    "周三：【灵修指引】今日分享真光：去探望一名感到灰心丧志或久病的教友。",
                    "周四：【灵修指引】今日听命练习：默想‘听从祂’。顺服一个你不喜欢的善意建议。",
                    "周五：【受难】参与拜苦路。默想：荣光的背后是荆棘。修德是通向永福的窄路。",
                    "周六：【渴望】深度自省：我对复活节新生命的渴望是否真切？还是只是例行公事？"
                ] 
            },
            { 
                week: "第三周", theme: "活水与渴望", focus: "承认干涸，寻求基督活水。", scripture: "若 4:5-42", 
                intro: "如同井边的妇人，我们常在世俗的井里寻找解渴的水，却越喝越渴。本周请坦诚面对内心的干涸，让基督的活水来填满。", 
                days: [
                    "主日：【福音】井边对话。焦点：我生命中那些无法让我真正满足的“世俗之水”是什么？",
                    "周一：【灵修指引】今日练习‘坦诚’。在祈祷中向天主承认一个你一直试图隐藏的弱点或执念。",
                    "周二：【灵修指引】今日练习‘解渴’。用15分钟阅读圣经，替代你平时用来刷手机“解闷”的时间。",
                    "周三：【灵修指引】今日练习‘见证’。像撒玛黎雅妇人一样，找机会向身边的人分享一次天主的恩宠。",
                    "周四：【灵修指引】今日练习‘专注’。在工作或家务时，每次喝水都默默念一句：“主，请赐我活水。”",
                    "周五：【受难】参与拜苦路。默想耶稣在十字架上的那句“我渴”。祂正在极度渴望我们的灵魂。",
                    "周六：【渴望】深度自省：我的信仰生活是按部就班的习惯，还是对天主充满热情的渴望？"
                ] 
            },
            { 
                week: "第四周", theme: "光明与盲目", focus: "医治属灵盲目，行在光明中。", scripture: "若 9:1-41", 
                intro: "“我是世界的光。”本周是喜乐主日(Laetare Sunday)，在悔改中我们瞥见复活曙光。求主开启我们信德的盲眼。", 
                days: [
                    "主日：【福音】瞎子复明。焦点：承认自己的无知与盲目，不急于评判他人，求主开眼。",
                    "周一：【灵修指引】今日练习‘不评判’。当你想在心里批评某人时，立刻停下，为他念一遍圣母经。",
                    "周二：【灵修指引】今日练习‘光明’。今天刻意去找寻并赞美三个人身上的优点，认出天主的光。",
                    "周三：【灵修指引】今日练习‘醒觉’。闭上眼睛一分钟体会盲目，睁开眼后感谢天主赐予的每一份平凡恩典。",
                    "周四：【灵修指引】今日练习‘听命’。瞎子听命去洗眼才复明。今天请绝对顺服长上或家人的一个合理要求。",
                    "周五：【受难】参与拜苦路。默想：世人瞎了眼，把真光钉在十字架上。求主光照我的愚昧与冷漠。",
                    "周六：【谦卑】深度自省：我是否常常自以为是（“我们不是瞎子吧？”），从而拒绝了天主的纠正？"
                ] 
            },
            { 
                week: "第五周", theme: "死亡与生命", focus: "死于旧我，解开罪恶束缚。", scripture: "若 11:1-45", 
                intro: "“解开他，让他行走！”耶稣呼唤拉匝禄走出坟墓。这也是对我们被罪恶缠绕的灵魂的呼唤。准备好抛弃缠带了吗？", 
                days: [
                    "主日：【福音】拉匝禄复活。焦点：我生命中哪些部分已经“死去”发臭，需要基督的呼唤来复苏？",
                    "周一：【灵修指引】今日练习‘痛悔’。深入省察自己最根深蒂固的一个罪，呼求耶稣：“主，救我！”",
                    "周二：【灵修指引】今日练习‘解绑’。戒除一个你非常依赖的小习惯（如某款游戏、熬夜），削弱旧我的控制。",
                    "周三：【灵修指引】今日练习‘希望’。去安慰一个正在经历挫折或悲伤的人，把复活的盼望带给他。",
                    "周四：【灵修指引】今日练习‘信赖’。即使面对似乎无法解决的难题，也在心里复述：“主，我知道祢能。”",
                    "周五：【受难】参与拜苦路。默想：基督为我们尝了死味，为叫我们获得永生。",
                    "周六：【准备】深度自省：圣周即将到来，我的心准备好与主同死同葬，好能同复活了吗？"
                ] 
            },
            { 
                week: "圣周", theme: "逾越与救赎", focus: "紧紧跟随，陪主走完最后旅程。", scripture: "玛 26:14-27:66", 
                intro: "这一周，请尽量推掉不必要的世俗应酬。保持内心的极度安静，我们要与主同赴圣筵，同赴苦架，同入坟墓。", 
                days: [
                    "主日：【圣枝主日】手持圣枝欢呼。反思：今天我欢呼祂为王，明天我是否会因懦弱而将祂出卖？",
                    "周一：【灵修指引】今日练习‘倾其所有的爱’。像玛利亚抹香液一样，为天主或家人做一件毫无保留的付出。",
                    "周二：【灵修指引】今日练习‘警醒’。检查自己在金钱、利益面前，是否有妥协信仰底线的念头。",
                    "周三：【灵修指引】今日练习‘忠诚’。在一切小事上保持绝对忠诚。务必在今日或之前完成妥当告解。",
                    "周四：【建立圣体】参与主的晚餐弥撒。主跪下为我洗脚，我愿意去洗仇人的脚吗？今夜请朝拜圣体。",
                    "周五：【主受难日】全日守大小斋。下午3点保持绝对静默。在苦像前亲吻伤痕，痛悔己罪。",
                    "周六：【安息守夜】在空荡的祭台前静默。今晚参与逾越节守夜礼，更新洗礼誓愿，迎接真光复活！"
                ] 
            }
        ];

        const stationsDetailed = [
            { 
                id: 1, title: "第一处", name: "耶稣判死刑", 
                scripture: "“彼拉多为了取悦群众...把耶稣交出来钉在十字架上。” (玛27:26)", 
                med: "主，在不义的审判面前祢保持了神圣的静默。多少次，我为了保全自己的面子或出于‘合群’的压力，也曾在公义面前保持了错误的沉默？祢的静默不是无能，而是对天父旨意的全然顺服。求祢治愈我那颗爱面子胜过爱真理的心。", 
                prayer: "主耶稣，求祢赐我勇气，让我在真理受威胁时，能不顾世俗评判为祢作证。阿们。", 
                res: "今日定志：不论面对多大压力，今日绝不说任何违背良知的辩解之词。" 
            },
            { 
                id: 2, title: "第二处", name: "耶稣背苦架", 
                scripture: "“耶稣自己背着十字架出来，到了一个地方，名叫髑髅。” (若19:17)", 
                med: "这根沉重的木梁，压在祢累伤的肩上。我的十字架是什么？是难以相处的同事，还是那无法摆脱的隐疾？祢没有抱怨，而是以此作为救赎。请教导我，如何带着爱去接纳那些我目前无法改变的人生重担。", 
                prayer: "主耶稣，请赐我接纳的恩宠，让我在每日琐碎的负担里，依然能看见救赎的希望。阿们。", 
                res: "今日定志：今日不抱怨遇到的任何繁琐工作或不顺心的家庭突发事件。" 
            },
            { 
                id: 3, title: "第三处", name: "耶稣一跌倒", 
                scripture: "“祂实在承担了我们的疾苦，背负了我们的痛苦。” (依53:4)", 
                med: "天主的圣子竟然倒在了尘土中。虚弱夺走了祢的体力，但爱支撑着祢的灵魂。跌倒并不可怕，可怕的是倒下后沉溺于绝望而不再渴望站起。主，当我因罪而反复跌倒时，求祢拉我一把。", 
                prayer: "主耶稣，求祢在我软弱跌倒时做我的支柱，赐我重新站起并诚心悔改的坚韧。阿们。", 
                res: "今日定志：针对一个我最常犯的小毛病，今日进行三次主动克制练习。" 
            },
            { 
                id: 4, title: "第四处", name: "耶稣遇圣母", 
                scripture: "“有一把利剑要刺透你的心灵。” (路2:35)", 
                med: "两个最爱的人，在痛苦中相遇。圣母陪伴主走苦路。圣母，请在我的苦路上也陪伴着我。", 
                prayer: "至圣童贞玛利亚，求祢在我遭受误解或灰心时，领我走向祢的爱子耶稣。阿们。", 
                res: "今日定志：今日主动致电或探望父母、长辈，并为已故教友祈祷。" 
            },
            { 
                id: 5, title: "第五处", name: "西满助耶稣", 
                scripture: "“他们抓住一个名叫西满的，叫他背起十字架，跟在耶稣后面。” (路23:26)", 
                med: "西满虽是被迫，却分担了救主的重担。我愿意在小事上分担近人的负担吗？哪怕只是多做一点微不足道的杂活。", 
                prayer: "主耶稣，求祢除去我的自私，让我在别人需要援手时，能毫不犹豫地挺身而出。阿们。", 
                res: "今日定志：今日额外帮家人或同事分担一项本不属于我的琐事。" 
            },
            { 
                id: 6, title: "第六处", name: "圣妇拭圣面", 
                scripture: "“主，我要寻求祢的面。” (咏27:8)", 
                med: "维罗尼卡用爱德的手帕，在圣面上印下了爱。面对社会的冷漠，我的一点温柔也有永恒的价值。我愿意成为这方手帕吗？", 
                prayer: "主耶稣，求祢将祢的圣容印在我的灵魂里，使我的一举一动都能彰显祢。阿们。", 
                res: "今日定志：今日对每一位为你提供服务的人露出最诚挚的微笑。" 
            },
            { 
                id: 7, title: "第七处", name: "耶稣二跌倒", 
                scripture: "“凡是自卑的，必被提升。” (路14:11)", 
                med: "伤口再次撕裂。这提醒我：圣德是无数次失败后的坚持。主，当我因修行枯燥而想放弃时，求赐我持久的恒心。", 
                prayer: "主耶稣，求祢赐我坚持的恒心，让我不在漫长的修行道路上中途而废。阿们。", 
                res: "今日定志：不论今日多忙碌，都要高质量地完成定下的读经计划。" 
            },
            { 
                id: 8, title: "第八处", name: "耶稣劝妇女", 
                scripture: "“耶路撒冷女子！不要为我哭，应为你们和你们的孩子哭。” (路23:28)", 
                med: "主，祢自身难保却顾念他人。我是否太关注自己的痛，而忽视了那些在灵性死亡边缘挣扎的灵魂？教导我为世界之罪而悔恨。", 
                prayer: "主耶稣，求祢扩大我的心胸，使我能体察他人的疾苦，并为罪人献上代祷。阿们。", 
                res: "今日定志：今日戒掉一项娱乐，将省下的时间专门用于为世界和平代祷。" 
            },
            { 
                id: 9, title: "第九处", name: "耶稣三跌倒", 
                scripture: "“我的能力在软弱中才全显出来。” (格后12:9)", 
                med: "就在终点边缘，祢似乎被击垮了。主是绝望者最后的唯一依恃。求主赐我在每一个看起来无望的绝处依然信靠主恩。", 
                prayer: "主耶稣，在人生的每一个尽头，求祢做我的支柱，让我能走完这段归程。阿们。", 
                res: "今日定志：在今日最疲惫、最想发怒的瞬间，先默念：‘主，救我。’" 
            },
            { 
                id: 10, title: "第十处", name: "耶稣被剥衣", 
                scripture: "“他们分了我的衣服，为我的长衣抽了签。” (咏22:19)", 
                med: "剥去外物，显露赤诚。求主剥去我的虚荣心、爱面子的虚伪、以及对物质过度的病态贪恋。让我赤诚见祢。", 
                prayer: "主耶稣，求祢剥去我的虚假，让我能以单纯的心，诚实地在圣事前承认罪过。阿们。", 
                res: "今日定志：今日清理掉一件我不再需要、但一直由于贪欲而占有的多余物品。" 
            },
            { 
                id: 11, title: "第十一处", name: "耶稣钉架上", 
                scripture: "“父啊，宽赦他们吧！因为他们不知道他们做的是什么。” (路23:34)", 
                med: "长钉穿过手足。主在剧痛中选择了宽恕。我心中还有那份隐隐作痛、不愿原谅他人的‘钉子’吗？请主今日拔除它。", 
                prayer: "主耶稣，求祢治愈我因仇恨而留下的伤疤，赐我彻底原谅他人的超自然力量。阿们。", 
                res: "今日定志：在心中诚挚地对一位曾伤害过我的人说：‘我选择宽恕你。’" 
            },
            { 
                id: 12, title: "第十二处", name: "耶稣死架上", 
                scripture: "“耶稣大声喊说：‘父啊！我把我的灵魂交托在祢手中。’” (路23:46)", 
                med: "在静默中注视这份伟大的爱。天主为我而死。还有什么计较放不下呢？主，愿祢的死亡成为我灵魂苏醒的起点。", 
                prayer: "主耶稣，愿祢的死亡成为我的新生。我愿从此死于旧我，活于基督。阿们。", 
                res: "今日定志：今日下午3点，面向苦像保持3分钟绝对静默的跪拜朝拜。" 
            },
            { 
                id: 13, title: "第十三处", name: "耶稣下苦架", 
                scripture: "“有一个人名叫若瑟...他领下了耶稣的遗体。” (路23:50-53)", 
                med: "圣母怀抱爱子。求主使我在经历人生丧恸时，能紧紧靠在圣母怀里，学会在寂静中托付主旨。", 
                prayer: "圣母玛利亚，在我人生的终点，请领我回到耶稣基督的慈悲怀抱中。阿们。", 
                res: "今日定志：诵念一段经文，专门为这一生中已去世的所有恩人、教友祈祷。" 
            },
            { 
                id: 14, title: "第十四处", name: "耶稣葬于墓", 
                scripture: "“他在坟墓门口滚上一块大石头，就走了。” (玛27:60)", 
                med: "黑暗中孕育着真光。坟墓不是终点，而是复活的摇篮。我相信复活的承诺。我在大石头后等待，带着满怀的希望。", 
                prayer: "主耶稣，求祢守护我的信心，让我在每一个无望的墓穴外，都能预见复活。阿们。", 
                res: "今日定志：在圣号下写下一件我最期待在复活节改过的志向，并存入圣经。" 
            }
        ];

        // 完整还原的深度省察清单
        const confessionContentData = {
            examItems: [
                { 
                    cat: "天主十诫 (深入省察清单)", 
                    items: [
                        { q: "第一诫：我是否忽略了每日祈祷？是否参与算命迷信（塔罗、星座决定行动等）？是否把金钱地位看得重于天主？是否故意怀疑天主道理？", id: "c1" },
                        { q: "第二诫：我是否在愤怒或开玩笑时乱用主名？是否指着天主发虚誓？是否对教堂内圣物、礼仪表现出明显不敬？", id: "c2" },
                        { q: "第三诫：我是否主日无故缺席全弥撒？弥撒中是否玩手机、分心？主日是否不顾灵魂休息而执着于重体力活？", id: "c3" },
                        { q: "第四诫：我是否尊重并照顾年老的父母？是否在言辞上顶撞长辈？作为父母，是否忽略了子女的信仰培育和陪伴？", id: "c4" },
                        { q: "第五诫：我是否怀恨他人？不愿宽恕？是否伤害过他人身体？是否曾教唆或参与堕胎？是否由于放纵恶习损害自身健康？", id: "c5" },
                        { q: "第六、九诫：我是否观看色情影像？是否有过婚前性行为、婚外情或手淫？言行举止是否轻浮？是否贪恋他人伴侣？", id: "c6" },
                        { q: "第七、十诫：我是否偷窃、挪用公私财物？工作是否偷懒虚报工时？是否有借不还？是否嫉妒他人的好运而心怀不平？", id: "c7" },
                        { q: "第八诫：我是否说谎欺骗？是否诽谤他人名誉、在背后传闲话？是否泄露了他人的隐私秘密？是否断章取义地评价他人？", id: "c8" }
                    ]
                },
                { 
                    cat: "七罪宗：灵魂根源的顽疾", 
                    items: [
                        { q: "骄傲：自以为是，看不起人。悭吝：贪得无厌，对穷人铁石心肠。迷色：放纵私欲。", id: "s1" },
                        { q: "愤怒：充满报复冲动。贪饕：暴饮暴食。嫉妒：见不得别人好。懒惰：荒废光阴。", id: "s2" }
                    ]
                }
            ],
            steps: [
                { t: "1. 进场准备", d: "怀着谦卑的心。画十字圣号，说：‘请神父降福，我罪人愿在教会内悔改。我上次告解是在（大概时间）前。’" },
                { t: "2. 坦诚告明", d: "诚实说出罪过。对于重大的罪，应说明次数。完结说：‘还有我省察不到的罪，也求主宽恕。’" },
                { t: "3. 教导与补赎", d: "聆听神父劝诫。记住‘补赎’内容（通常是几遍经文或一件具体的善行）。" },
                { t: "4. 念痛悔经", d: "神父会请你念痛悔经。这时以最真诚的心诵念。" },
                { t: "5. 赦罪与平安", d: "神父念赦免经并在你上方画十字。答：‘感谢天主。’ 带着新生的喜乐走出。" }
            ]
        };

        const holyWeekPlan = [
            { day: "圣枝主日 (3/29)", title: "基督受难主日", focus: "欢迎和平之王进城奉献。礼仪由欢呼转入受难福音。", liturgy: "祝圣圣枝、圣枝游行、长篇受难史宣读。", act: "带回圣枝放在家中十字架旁。反思：我是否在口头欢呼主，在行动中却抛弃主？" },
            { day: "圣周一至三", title: "心灵静默准备期", focus: "这是心灵大扫除的最后时机。默想救主如何被一步步推向加尔瓦略山。", liturgy: "早晨弥撒，堂区安排全天候告解。", act: "务必在此期间完成圣事性的告解。保持生活环境极简与肃静。" },
            { day: "圣周四 (4/2)", title: "逾越节三日庆典 (开始)", focus: "‘建立圣体’与‘爱德诫命’。主耶稣在此夜为门徒洗脚，并献出体血。", liturgy: "濯足礼；圣体迁往临时祭台；剥除祭台装饰，遮盖圣像。", act: "参与朝拜圣体直到深夜（陪伴山园中的主）。感受那份孤独中的大爱。" },
            { day: "圣周五 (4/3)", title: "救主受难纪念", focus: "十字架上的伟大赎献。天主为人类而死。此时全地黑暗。", liturgy: "全日不举行弥撒。朝拜十字架及领受预圣圣体。严守大小斋。", act: "下午3点绝对静默。在圣堂亲吻主受难的伤痕，反省我罪。" },
            { day: "圣周六 (4/4)", title: "逾越节守夜礼 (礼仪之母)", focus: "由死亡经过进入生命的时刻。礼仪之母。", liturgy: "祝圣新火、复活宣报、九篇读经、重申洗礼誓愿。", act: "晚上全程参与隆重守夜礼。迎接真光复活，重生为新造的人。" },
            { day: "复活节 (4/5)", title: "耶稣复活大瞻礼", focus: "死亡被废除了！基督得胜了！这是我们信仰的根基。", liturgy: "欢唱阿肋路亚，弥撒充满白金荣光。", act: "庆祝复活！将这份喜乐带给家人。立志从此活出复活者的光明生活。" }
        ];

        const encyclopediaData = [
            { 
                cat: "逾越节奥迹深度介绍", 
                desc: "‘逾越’（Pascha）意为‘经过’。旧约逾越是天主‘经过’了涂血的门，拯救以色列子民脱离埃及奴役。新约中，基督是真正的逾越羔羊，祂通过四个阶段完成了我们的救赎：\n1. 经过自我（圣周四）：基督在爱中彻底空虚自己，建立圣体。祂由‘世界’逾越到‘父’那里去。\n2. 经过痛苦（圣周五）：基督作为罪人的替身，走入死亡的深渊。祂以无罪之身经过了死亡的痛苦。\n3. 经过阴府（圣周六）：基督降入死亡的底部，救拔自亚当以来的古圣先贤。这是神圣的守望时刻。\n4. 经过死亡（复活日）：基督彻底粉碎了死亡。死亡不再是终点，而是门径。\n这也揭示了每个信友的生命：必须‘死于旧我’，才能‘活于基督’。" 
            },
            { 
                cat: "大小斋精准规则", 
                desc: "教会要求信友通过约束身体来唤醒灵魂，磨练意志以专注主言：\n• 小斋 (Abstinence)：\n  - 时间：四旬期内的每一个周五，及全年周五（除重大庆日）。\n  - 要求：不食禽兽肉。鱼、虾、蛋奶不受限制。\n  - 适用：凡年满14岁的教友至终身。\n• 大斋 (Fasting)：\n  - 时间：圣灰礼仪日、耶稣受难日（圣周五）。\n  - 要求：全日仅进一餐饱食。严禁在正餐外进食零食。饮水及药物不限。\n  - 适用：凡年满18岁至60岁的教友。孕妇、病弱、繁重劳务者可豁免，但应以爱德补之。" 
            },
            {
                cat: "四旬期与洗礼更新",
                desc: "四旬期在初期教会的核心是‘圣洗预备期’。候洗者在这40天中接受最后的考核与教导。对于已领洗的信友，这40天则是‘洗礼誓愿的重新激活’。我们通过克己、祈祷和爱德，洗净生活中的尘垢，准备在复活夜重新宣誓：‘我拒绝魔鬼，我拒绝罪恶，我信赖天主。’ 这是一个生命重生的恩宠时期。"
            }
        ];


        // ================= 核心逻辑与渲染 =================
        
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            const footer = document.getElementById('exam-footer');
            const quote = document.getElementById('quote-card');
            
            if(tabId === 'confession') {
                footer.classList.remove('hidden');
                quote.classList.add('hidden'); 
            } else {
                footer.classList.add('hidden');
                quote.classList.remove('hidden');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if(typeof lucide !== 'undefined') lucide.createIcons();
        }

        function showConfSub(subId) {
            document.querySelectorAll('.conf-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(subId).classList.remove('hidden');
            document.querySelectorAll('.conf-sub-btn').forEach(btn => { 
                btn.classList.remove('conf-nav-active'); 
                btn.classList.add('text-indigo-700'); 
            });
            document.getElementById('btn-' + subId).classList.add('conf-nav-active');
            document.getElementById('btn-' + subId).classList.remove('text-indigo-700');
            if(typeof lucide !== 'undefined') lucide.createIcons();
        }

        function getPlanForDate(dateStr) {
            if(dailyFullPlan[dateStr]) return dailyFullPlan[dateStr];
            const isFri = new Date(dateStr).getDay() === 5;
            return { 
                mentor: "在寂静中，基督正注视着你。今日请在平凡的生活中，彰显信仰的力量。", 
                p: "阅读并深度默想当日礼仪读经（建议30分钟）", 
                f: isFri ? "【小斋】今日戒食肉食；禁绝午后甜点" : "节制一项由于无聊而引起的感官爱好", 
                a: isFri ? "15:00 参与堂区拜苦路与弥撒" : "今日默默进行一件不为人知的爱德善功" 
            };
        }

        function initProgressSystem() {
            const start = new Date(config.startDate);
            const today = new Date(); 
            const dateKey = today.toISOString().split('T')[0];
            const diffMs = today - start;
            const diffDays = Math.ceil(Math.max(0, diffMs / (1000 * 60 * 60 * 24)));
            const weekIdx = Math.floor((diffDays - 1) / 7);

            let displayDays = Math.max(0, Math.min(diffDays, 46));
            document.getElementById('progress-bar').style.width = `${(displayDays / 46) * 100}%`;
            document.getElementById('progress-week-text').innerText = diffDays <= 4 ? "圣灰礼仪后" : `四旬期第 ${weekIdx + 1} 周`;
            document.getElementById('progress-text').innerText = `Day ${displayDays} / 46`;
            document.getElementById('today-date-string').innerText = dateKey;

            document.getElementById('milestones-container').innerHTML = config.milestones.map((m, i) => `
                <div class="milestone-dot w-3 h-3 rounded-full border border-violet-500 pointer-events-auto ${diffDays >= m.offset ? 'active-dot' : 'bg-violet-900/40'}"></div>
            `).join('');

            const plan = getPlanForDate(dateKey);
            document.getElementById('dynamic-guidance-text').innerText = plan.mentor;
            renderHomeTasks(plan, dateKey);
        }

        function renderHomeTasks(plan, dateKey) {
            const cats = [
                { n: '祈祷 (Prayer)', i:'book-open', c:'text-purple-600', t:[plan.p, "晚间意识省察：寻找今日三个恩赐"] },
                { n: '斋戒 (Fasting)', i:'coffee', c:'text-indigo-600', t:[plan.f, "今日斋戒：不抱怨任何不顺心"] },
                { n: '爱德 (Almsgiving)', i:'heart', c:'text-rose-600', t:[plan.a, "今日对一位难以忍受者保持耐心"] }
            ];
            document.getElementById('task-categories').innerHTML = cats.map((cat, cIdx) => `
                <div class="space-y-3">
                    <h4 class="text-[10px] font-black uppercase tracking-[0.2em] ${cat.c} flex items-center gap-2"><i data-lucide="${cat.i}" class="w-3.5 h-3.5"></i> ${cat.n}</h4>
                    <div class="space-y-2.5">
                        ${cat.t.map((item, tIdx) => {
                            const taskId = `task_${dateKey}_${cIdx}_${tIdx}`;
                            const isDone = localStorage.getItem(taskId) === 'true';
                            return `
                                <div onclick="toggleTask('${taskId}', this)" class="task-item flex items-start gap-4 p-4 rounded-[1.2rem] border ${isDone ? 'is-checked border-green-300' : 'border-gray-100 bg-gray-50/50'} cursor-pointer hover:bg-white shadow-sm transition-all">
                                    <div class="check-box w-6 h-6 rounded-[10px] border-2 border-violet-200 flex items-center justify-center bg-white shrink-0 mt-0.5">
                                        <i data-lucide="check" class="check-svg w-3 h-3 text-white ${isDone ? '' : 'hidden'}"></i>
                                    </div>
                                    <span class="text-[13px] font-bold text-gray-800 leading-relaxed">${item}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(id, el) {
            const isDone = el.classList.toggle('is-checked');
            el.querySelector('.check-svg').classList.toggle('hidden');
            if(isDone) localStorage.setItem(id, 'true'); else localStorage.removeItem(id);
        }

        function renderWeeklyList() {
            document.getElementById('weekly-list').innerHTML = weeklyFullData.map(w => `
                <div class="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm relative overflow-hidden">
                    <div class="flex items-center justify-between mb-5 border-b border-gray-50 pb-5">
                        <h4 class="text-xl font-black text-gray-900 tracking-tighter">${w.theme}</h4>
                        <span class="text-[9px] bg-violet-100 text-violet-700 px-3 py-1.5 rounded-full font-black uppercase tracking-widest">${w.week}</span>
                    </div>
                    <div class="mb-6 p-5 bg-violet-50 rounded-[1.5rem] border border-violet-100">
                        <p class="text-[12px] text-violet-950 font-bold leading-[2] italic font-serif-church">“${w.intro}”</p>
                        <p class="text-[10px] text-violet-500 mt-3 font-black tracking-widest flex items-center gap-1.5"><i data-lucide="bookmark" class="w-3 h-3"></i> 读经: ${w.scripture}</p>
                    </div>
                    <div class="bg-stone-50 p-5 rounded-[1.5rem] border border-stone-100">
                        <h5 class="text-[9px] font-black text-stone-400 uppercase tracking-widest mb-4">本周每日方案</h5>
                        <div class="space-y-3">
                            ${w.days.map((d, i) => `
                                <div class="text-[12px] text-gray-700 leading-relaxed flex gap-3">
                                    <span class="font-black text-violet-400 shrink-0">D${i+1}</span>
                                    <p class="font-medium">${d}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderStationsList() {
            document.getElementById('stations-list').innerHTML = stationsDetailed.map(s => `
                <div class="bg-white p-6 rounded-[2rem] border border-gray-100 shadow-sm station-accent">
                    <div class="flex justify-between items-center mb-5">
                        <span class="text-[10px] font-black text-stone-400 uppercase tracking-widest">${s.title}</span>
                        <div class="w-10 h-10 rounded-[12px] bg-stone-900 text-white flex items-center justify-center text-sm font-black shadow-md">${s.id}</div>
                    </div>
                    <h4 class="text-xl font-black text-stone-950 mb-4 tracking-tight">${s.name}</h4>
                    <div class="p-5 bg-stone-50 rounded-[1.5rem] border border-stone-100 mb-5 font-serif-church italic text-stone-800 text-[13px] leading-[2]">
                        ${s.scripture}
                    </div>
                    <div class="space-y-5">
                        <div class="prose-church">
                            <h5 class="text-[10px] font-black text-stone-400 uppercase tracking-widest mb-2 flex items-center gap-1.5">神学默想</h5>
                            <p class="text-[13px] text-gray-600 font-medium leading-[1.8]">“${s.med}”</p>
                        </div>
                        <div class="bg-violet-50 p-5 rounded-[1.5rem] border border-violet-100">
                            <strong class="flex items-center gap-2 mb-2 text-[10px] text-violet-700 uppercase tracking-widest font-black"><i data-lucide="target" class="w-3.5 h-3.5"></i> 今日定志行动</strong>
                            <p class="text-[13px] text-violet-950 font-bold leading-relaxed">${s.res}</p>
                        </div>
                        <div class="bg-indigo-50/50 p-4 rounded-[1.2rem] italic text-[11px] text-indigo-700 font-medium leading-relaxed">
                            <strong>经文祷词：</strong> ${s.prayer}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderHolyWeekPlan() {
            document.getElementById('holyweek-list').innerHTML = holyWeekPlan.map(h => `
                <div class="bg-white p-6 rounded-[2rem] border-l-[8px] border-l-red-900 shadow-sm space-y-5">
                    <div class="flex flex-col gap-2">
                        <span class="text-[9px] font-black text-red-700 uppercase tracking-widest border border-red-100 px-3 py-1 rounded-full w-fit bg-red-50">${h.day}</span>
                        <h3 class="text-xl font-black text-red-950 tracking-tighter">${h.title}</h3>
                    </div>
                    <div class="space-y-3">
                        <div class="p-5 bg-gray-50 rounded-[1.5rem] border border-gray-100">
                            <h5 class="text-[9px] font-black text-gray-400 uppercase tracking-widest mb-2">救赎焦点</h5>
                            <p class="text-[13px] text-gray-700 font-medium leading-[1.8]">${h.focus}</p>
                        </div>
                        <div class="p-5 bg-red-50/50 rounded-[1.5rem] border border-red-100">
                            <h5 class="text-[9px] font-black text-red-800 uppercase tracking-widest mb-2">礼仪环节</h5>
                            <p class="text-[13px] text-red-900 font-bold leading-[1.8]">${h.liturgy}</p>
                        </div>
                    </div>
                    <div class="bg-red-900 p-6 rounded-[1.5rem] text-white shadow-md">
                        <p class="text-[13px] font-bold leading-relaxed flex items-start gap-3 italic font-serif-church">
                            <i data-lucide="heart" class="w-4 h-4 fill-white text-red-900 mt-1 shrink-0"></i>
                            “${h.act}”
                        </p>
                    </div>
                </div>
            `).join('');
        }

        function renderEncyclopedia() {
            document.getElementById('liturgy-info-list').innerHTML = encyclopediaData.map(i => `
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-amber-50">
                    <h4 class="text-amber-950 font-black text-xl mb-5 flex items-center gap-3">
                        <span class="w-10 h-10 bg-amber-100 text-amber-700 rounded-[12px] flex items-center justify-center"><i data-lucide="book-open" class="w-5 h-5"></i></span>
                        ${i.cat}
                    </h4>
                    <p class="text-[13px] text-gray-600 leading-[2] whitespace-pre-line font-medium prose-church">${i.desc}</p>
                </div>
            `).join('');
        }

        function renderConfData() {
            document.getElementById('exam-list-container').innerHTML = confessionContentData.examItems.map(section => `
                <div class="space-y-5">
                    <h4 class="font-black text-indigo-950 text-lg flex items-center gap-2.5">
                        <span class="w-1.5 h-6 bg-indigo-600 rounded-full"></span> ${section.cat}
                    </h4>
                    <div class="space-y-3">
                        ${section.items.map(q => {
                            const isDone = localStorage.getItem(`conf_${q.id}`) === 'true';
                            return `
                                <div onclick="toggleExamCheck(this, '${q.id}', '${q.q.split('？')[0]}')" class="exam-item flex items-start gap-4 p-4 rounded-[1.5rem] border ${isDone ? 'is-checked border-indigo-300' : 'border-gray-100 bg-gray-50/30'} cursor-pointer transition-all">
                                    <div class="exam-check-box w-6 h-6 rounded-[8px] border-2 border-indigo-200 shrink-0 mt-0.5 flex items-center justify-center bg-white">
                                        <i data-lucide="check" class="exam-check-svg w-3.5 h-3.5 text-white ${isDone ? '' : 'hidden'}"></i>
                                    </div>
                                    <p class="text-[13px] text-gray-700 leading-[1.8] font-medium">${q.q}</p>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');
            
            document.getElementById('confession-script').innerHTML = confessionContentData.steps.map((s, i) => `
                <div class="relative pl-10 border-l-2 border-dashed border-indigo-100 pb-8 last:pb-0">
                    <div class="absolute -left-[15px] top-0 w-7 h-7 rounded-[8px] bg-indigo-600 text-white flex items-center justify-center text-xs font-black border-[3px] border-white">${i+1}</div>
                    <h5 class="font-black text-indigo-950 text-sm mb-2 tracking-tight">${s.t}</h5>
                    <div class="bg-gray-50 p-4 rounded-2xl text-[12px] text-gray-600 font-medium leading-relaxed">${s.d}</div>
                </div>
            `).join('');
            
            document.getElementById('prayers-container').innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-black text-indigo-950 border-l-4 border-indigo-600 pl-3">白话版痛悔经</h4>
                    <p class="text-[13px] leading-relaxed text-gray-700 bg-indigo-50/50 p-5 rounded-2xl">天主，为了我所犯的一切罪过，并为了我失职的罪，我全心痛悔。因为我得罪了祢——极仁慈、极美善的天主。我决志藉着祢的恩宠，再不敢得罪祢，并躲避犯罪的机会。阿们。</p>
                </div>
                <div class="space-y-4 mt-6">
                    <h4 class="text-lg font-black text-indigo-400 border-l-4 border-indigo-400 pl-3">文言版痛悔经</h4>
                    <p class="text-[13px] leading-relaxed text-gray-600 bg-gray-50 p-5 rounded-2xl font-serif-church italic">吾主耶稣，基利斯督，造我养我，救我之主。我重罪人，得罪天主。今特为爱天主在万有之上，专心痛悔，恼恨我罪，决意定改，宁死再不敢得罪天主。望主看你圣苦难之功，可怜我等。阿们。</p>
                </div>
            `;
            updateExamBadge();
        }

        function toggleExamCheck(el, id, text) {
            const isChecked = el.classList.toggle('is-checked');
            el.querySelector('.exam-check-svg').classList.toggle('hidden');
            if (isChecked) { 
                localStorage.setItem(`conf_${id}`, 'true'); 
                localStorage.setItem(`conf_text_${id}`, text); 
            } else { 
                localStorage.removeItem(`conf_${id}`); 
                localStorage.removeItem(`conf_text_${id}`); 
            }
            updateExamBadge();
        }

        function updateExamBadge() { document.getElementById('exam-badge').innerText = document.querySelectorAll('.exam-item.is-checked').length; }
        
        function copyConfessionList() {
            let listText = "【告解备忘录】\n", hasItems = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('conf_text_')) { 
                    listText += "• " + localStorage.getItem(key) + "...\n"; 
                    hasItems = true; 
                }
            }
            if (!hasItems) return alert("您还没有勾选任何条目。");
            navigator.clipboard.writeText(listText).then(() => alert("已复制！排队办告解时可粘贴到备忘录中查看。"));
        }
        
        function resetExam() {
            if(confirm("确定要清空告解记录吗？")) {
                let keys = [];
                for(let i=0; i<localStorage.length; i++) { 
                    if(localStorage.key(i).startsWith('conf_')) keys.push(localStorage.key(i)); 
                }
                keys.forEach(k => localStorage.removeItem(k));
                renderConfData();
            }
        }

        // ================= 初始化与事件 =================
        
        window.onload = () => {
            try {
                initProgressSystem();
                renderWeeklyList();
                renderStationsList();
                renderConfData();
                renderHolyWeekPlan();
                renderEncyclopedia();

                if(typeof lucide !== 'undefined') lucide.createIcons();
                
                // 隐藏加载动画
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);

                // 随机名言轮播逻辑
                setInterval(() => {
                    const el = document.getElementById('daily-quote');
                    const card = document.getElementById('quote-card');
                    if(el && !card.classList.contains('hidden')) {
                        el.parentElement.style.opacity = '0';
                        setTimeout(() => { 
                            el.innerText = quotes[Math.floor(Math.random() * quotes.length)];
                            el.parentElement.style.opacity = '1'; 
                        }, 700);
                    }
                }, 10000);

                // Service Worker 注册 (PWA支持)
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js').catch(console.error);
                }
            } catch (error) {
                // 如果发生致命错误，解除 loading 遮罩以显示上方注入的 error 信息
                document.getElementById('loading-screen').style.display = 'none';
                throw error;
            }
        };
    </script>
</body>
</html>
